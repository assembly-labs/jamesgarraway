<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Tracker</title>
    <!-- Security Headers -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noodp, noimageindex, notranslate">
    <meta name="googlebot" content="noindex, nofollow">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">

    <!-- Preload background image for faster loading -->
    <link rel="preload" as="image" href="../images/minecraft-bg.png">
    <link rel="stylesheet" href="../styles/navigation.css?v=1763735221&bust=v5">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: monospace;
            background: #5a9fd4;
            color: white;
            padding: 20px;
            font-size: 18px;
            min-height: 100vh;
            position: relative;
        }

        /* Background image with overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            opacity: 0;
            z-index: -2;
            transition: opacity 0.5s ease;
        }

        /* Only show background when loaded */
        body.bg-loaded::before {
            background-image: url('../images/minecraft-bg.png');
            opacity: 1;
        }

        /* Dark overlay for readability */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: -1;
        }


        .container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Header with total */
        .header {
            background: rgba(51, 51, 51, 0.98);
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .total-coins {
            font-size: 48px;
            color: #ffD700;
            margin: 10px 0;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* Today's earnings display */
        .todays-earnings {
            background: rgba(37, 99, 235, 0.2);
            padding: 12px;
            margin: 15px 0;
            border-radius: 8px;
            font-size: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid rgba(37, 99, 235, 0.3);
        }

        .todays-earnings.negative {
            background: rgba(244, 67, 54, 0.3);
            border-color: rgba(244, 67, 54, 0.5);
        }

        .earning-amount {
            color: #60a5fa;
            font-weight: bold;
            font-size: 24px;
        }

        .earning-amount.negative {
            color: #f44336;
        }

        .date-nav {
            background: rgba(68, 68, 68, 0.95);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .date-btn {
            background: #666;
            border: 2px solid #333;
            color: white;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
        }

        .date-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .current-date {
            font-size: 20px;
            font-weight: bold;
        }

        /* Sections */
        .section {
            background: rgba(68, 68, 68, 0.95);
            padding: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 24px;
            color: #ffD700;
            margin-bottom: 15px;
        }

        /* Tasks */
        .task {
            background: #666;
            padding: 16px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .task:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .task.completed {
            background: #2563eb;  /* Changed to blue instead of green */
            animation: taskComplete 0.5s ease;
        }

        .task.completed .task-name {
            padding-left: 30px;  /* Make room for checkmark */
        }

        .task.completed::before {
            content: '‚úì';
            position: absolute;
            left: 16px;
            font-size: 24px;
            color: #ffffff;
            font-weight: bold;
        }

        @keyframes taskComplete {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Floating coin animation */
        .coin-animation {
            position: fixed;
            font-size: 32px;
            color: #ffD700;
            font-weight: bold;
            z-index: 9999;
            pointer-events: none;
            animation: floatUp 1.5s ease-out forwards;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }

        /* Confetti animation */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 9999;
            pointer-events: none;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .task-name {
            font-size: 18px;
        }

        .task-value {
            color: #ffD700;
            font-weight: bold;
        }

        /* Counter tasks */
        .counter-task {
            background: #666;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .counter-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .counter-btn {
            background: #888;
            border: 2px solid #333;
            color: white;
            width: 44px;
            height: 44px;
            font-size: 24px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-weight: bold;
        }

        .counter-btn:active:not(:disabled) {
            transform: scale(0.95);
            background: #999;
        }

        .counter-btn:disabled {
            opacity: 0.5;
        }

        .counter-value {
            font-size: 20px;
            color: #ffD700;
            min-width: 30px;
            text-align: center;
        }

        /* Penalties */
        .penalty-btn {
            background: #d32f2f;
            border: 2px solid #b71c1c;
            color: white;
            padding: 12px;
            margin-bottom: 10px;
            font-size: 18px;
            cursor: pointer;
            display: block;
            width: 100%;
        }

        .penalty-count {
            float: right;
            background: #b71c1c;
            padding: 2px 8px;
            border-radius: 3px;
        }

        /* Bonuses */
        .bonus {
            background: #666;
            padding: 12px;
            margin-bottom: 10px;
        }

        .bonus.active {
            background: #2563eb;  /* Blue instead of green for better contrast with yellow text */
        }

        .bonus-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-bar {
            background: #333;
            height: 20px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            background: #2563eb;  /* Blue instead of yellow for better contrast */
            height: 100%;
            transition: width 0.3s;
        }

        .progress-text {
            font-size: 14px;
            color: #ccc;
            margin-top: 5px;
        }

        /* Buttons */
        .calendar-btn {
            background: #666;
            border: 2px solid #333;
            color: white;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
        }

        .submit-btn {
            background: #22c55e;
            border: 2px solid #16a34a;
            color: #ffffff;
            padding: 15px 30px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 30px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .submit-btn:disabled {
            background: #888;
            border-color: #666;
            color: #555;
            cursor: not-allowed;
        }

        .saved-indicator {
            background: #22c55e;
            color: white;
            padding: 10px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 3px;
        }

        /* Calendar View */
        .calendar-view {
            display: none;
            background: rgba(68, 68, 68, 0.95);
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .calendar-view.show {
            display: block;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-month {
            font-size: 24px;
            color: #ffD700;
            font-weight: bold;
        }

        .calendar-nav-btn {
            background: #666;
            border: 2px solid #333;
            color: white;
            padding: 10px 15px;
            font-size: 20px;
            cursor: pointer;
            border-radius: 5px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day-header {
            background: #333;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #ffD700;
        }

        .calendar-day {
            background: #555;
            padding: 10px;
            min-height: 80px;
            cursor: pointer;
            position: relative;
            border-radius: 5px;
            transition: all 0.2s;
        }

        .calendar-day:hover {
            background: #666;
            transform: scale(1.05);
        }

        .calendar-day.other-month {
            background: #3a3a3a;
            opacity: 0.5;
        }

        .calendar-day.today {
            border: 2px solid #ffD700;
        }

        .calendar-day.has-data {
            background: #2563eb;
        }

        .calendar-day-number {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .calendar-day-coins {
            font-size: 14px;
            color: #ffD700;
        }

        /* Day Detail Modal */
        .day-detail-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(51, 51, 51, 0.98);
            padding: 20px;
            border-radius: 10px;
            z-index: 200;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .day-detail-modal.show {
            display: block;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 199;
        }

        .modal-overlay.show {
            display: block;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #666;
            border: none;
            color: white;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <!-- Skip Navigation Link (Accessibility) -->
    <a href="#totalCoins" class="skip-nav">Skip to main content</a>

    <!-- Sticky Navigation -->
    <nav class="sticky-nav" id="stickyNav">
        <div class="nav-container">
            <button class="nav-hamburger" id="navHamburger" aria-label="Menu">‚ò∞</button>
            <div class="nav-brand" id="navBrand">MINECOINS</div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="../" class="nav-link" data-page="home">HOME</a></li>
                <li><a href="../minecraft/" class="nav-link" data-page="minecoins">MINECOINS</a></li>
                <li><a href="../day/" class="nav-link" data-page="champion">CHAMPION ROUTINE</a></li>
                <li><a href="../magic8ball/" class="nav-link" data-page="magic8ball">MAGIC 8 BALL</a></li>
            </ul>
        </div>
    </nav>
    <div class="nav-overlay" id="navOverlay"></div>

    <div class="container">
        <!-- Header with total -->
        <div class="header">
            <div>TOTAL MINECOINS</div>
            <div class="total-coins" id="totalCoins">0</div>
            <div class="todays-earnings" id="todaysEarnings">
                <span>Today's Progress</span>
                <span class="earning-amount" id="todaysAmount">+0</span>
            </div>
        </div>

        <!-- Date Navigation -->
        <div class="date-nav">
            <button class="date-btn" onclick="changeDate(-1)">‚Üê</button>
            <div class="current-date" id="currentDate">Today</div>
            <button class="date-btn" id="nextBtn" onclick="changeDate(1)">‚Üí</button>
        </div>

        <!-- Calendar Toggle -->
        <button class="calendar-btn" onclick="toggleCalendar()">üìÖ View Calendar</button>

        <!-- Calendar View -->
        <div class="calendar-view" id="calendarView">
            <div class="calendar-header">
                <button class="calendar-nav-btn" onclick="changeCalendarMonth(-1)">‚Üê</button>
                <div class="calendar-month" id="calendarMonth">November 2024</div>
                <button class="calendar-nav-btn" onclick="changeCalendarMonth(1)">‚Üí</button>
            </div>
            <div class="calendar-grid" id="calendarGrid">
                <!-- Calendar will be rendered here -->
            </div>
        </div>

        <!-- Day Detail Modal -->
        <div class="modal-overlay" id="modalOverlay" onclick="closeDayDetail()"></div>
        <div class="day-detail-modal" id="dayDetailModal">
            <button class="modal-close" onclick="closeDayDetail()">√ó</button>
            <div id="dayDetailContent">
                <!-- Day details will be rendered here -->
            </div>
        </div>

        <!-- Tasks Section -->
        <div class="section">
            <div class="section-title">‚úÖ TASKS</div>
            <div id="tasks"></div>
        </div>

        <!-- Recreation Section -->
        <div class="section">
            <div class="section-title">üèÉ RECREATION</div>
            <div id="recreation"></div>
        </div>

        <!-- Penalties Section -->
        <div class="section">
            <div class="section-title">‚ö†Ô∏è PENALTIES</div>
            <div id="penalties"></div>
        </div>

        <!-- Bonuses Section -->
        <div class="section">
            <div class="section-title">üèÜ BONUSES</div>
            <div id="bonuses"></div>
        </div>

        <!-- Saved Indicator -->
        <div class="saved-indicator" id="savedIndicator" style="display: none;">
            ‚úÖ Daily Progress Saved!
        </div>

        <!-- Submit Button -->
        <button class="submit-btn" id="submitBtn" onclick="submitDailyProgress()">
            SUBMIT DAILY PROGRESS
        </button>
    </div>

    <script>
        // Preload and cache the background image
        const bgImage = new Image();
        bgImage.onload = function() {
            document.body.classList.add('bg-loaded');
        };
        bgImage.src = '../images/minecraft-bg.png';

        // Task definitions
        const TASKS = [
            { id: 'make_bed', name: 'Make Bed', coins: 5 },
            { id: 'help_dishes', name: 'Help with Dishes', coins: 5 },
            { id: 'clean_room', name: 'Clean Room', coins: 5 },
            { id: 'listen_first', name: 'Listen First Time', coins: 5 },
            { id: 'fill_bucket', name: "Fill Someone's Bucket", coins: 10 },
            { id: 'meditate', name: 'Meditate (5+ min)', coins: 20 },
            { id: 'help_without', name: 'Help Without Being Asked', coins: 10 },
            { id: 'trash', name: 'Take Out Trash', coins: 15 },
            { id: 'vacuum', name: 'Vacuum a Room', coins: 15 },
            { id: 'special', name: 'Special Project', coins: 30 }
        ];

        const RECREATION = [
            { id: 'jj_class', name: 'ü•ã Jiu-Jitsu Class', coins: 5 },
            { id: 'jj_respect', name: 'ü•ã Respect BJJ Coach', coins: 10 },
            { id: 'football', name: 'üèà Football Game', coins: 5 },
            { id: 'football_coach', name: 'üèà Listen to Football Coach', coins: 10 },
            { id: 'support_team', name: 'üèà Support the Team', coins: 10 }
        ];

        const PENALTIES = [
            { id: 'mild_curse', name: 'Mild Curse', coins: -5 },
            { id: 'strong_curse', name: 'Strong Curse', coins: -10 },
            { id: 'talking_back', name: 'Talking Back', coins: -5 },
            { id: 'not_listening', name: 'Not Listening', coins: -10 },
            { id: 'yelling', name: 'Yelling/Disrespect', coins: -10 }
        ];

        // State
        let data = {};
        let tempData = {}; // Temporary data for current day until submitted
        let currentDate = new Date().toISOString().split('T')[0];

        // Load data
        function loadData() {
            const stored = localStorage.getItem('minecoins');
            if (stored) {
                data = JSON.parse(stored);
            }
            // Initialize temp data for current date
            initializeTempData();
            render();
        }

        // Initialize temporary data for current date
        function initializeTempData() {
            const today = new Date().toISOString().split('T')[0];

            // If viewing today and no data saved yet, start fresh
            if (currentDate === today && !data[currentDate]) {
                tempData = {
                    tasks: {},
                    recreation: {},
                    penalties: {}
                };
            } else if (data[currentDate]) {
                // Copy existing data to temp
                tempData = JSON.parse(JSON.stringify(data[currentDate]));
            } else {
                tempData = {
                    tasks: {},
                    recreation: {},
                    penalties: {}
                };
            }
        }

        // Submit daily progress
        function submitDailyProgress() {
            // Save tempData to permanent data
            data[currentDate] = JSON.parse(JSON.stringify(tempData));
            localStorage.setItem('minecoins', JSON.stringify(data));

            // Show saved indicator
            const indicator = document.getElementById('savedIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);

            render();
        }

        // Change date
        function changeDate(direction) {
            const date = new Date(currentDate);
            date.setDate(date.getDate() + direction);
            currentDate = date.toISOString().split('T')[0];

            // Initialize temp data for new date
            initializeTempData();
            render();
        }

        // Show coin animation
        function showCoinAnimation(coins, event) {
            const coin = document.createElement('div');
            coin.className = 'coin-animation';
            coin.textContent = coins > 0 ? '+' + coins : coins;

            if (event) {
                coin.style.left = event.clientX + 'px';
                coin.style.top = event.clientY + 'px';
            } else {
                coin.style.left = '50%';
                coin.style.top = '50%';
            }

            document.body.appendChild(coin);
            setTimeout(() => coin.remove(), 1500);
        }

        // Throw confetti effect
        function throwConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffa500', '#ff69b4'];
            const confettiCount = 50;

            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    confetti.style.animation = `confetti-fall ${confetti.style.animationDuration} linear forwards`;

                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), parseFloat(confetti.style.animationDuration) * 1000);
                }, Math.random() * 200);
            }
        }

        // Track previous bonus states
        let previousBonusStates = {
            noCursing: false,
            recreation: false
        };

        // Toggle task
        function toggleTask(taskId, event) {
            const wasCompleted = tempData.tasks[taskId];
            tempData.tasks[taskId] = !tempData.tasks[taskId];

            // Show coin animation
            const task = TASKS.find(t => t.id === taskId);
            if (!wasCompleted && task) {
                showCoinAnimation(task.coins, event);
            }

            render();
        }

        // Update recreation counter
        function updateRecreation(taskId, delta) {
            const current = tempData.recreation[taskId] || 0;
            tempData.recreation[taskId] = Math.max(0, Math.min(3, current + delta));
            render();
        }

        // Update penalty counter
        function updatePenalty(penaltyId, delta) {
            const current = tempData.penalties[penaltyId] || 0;
            tempData.penalties[penaltyId] = Math.max(0, current + delta);
            render();
        }

        // Calculate total
        function calculateTotal() {
            let total = 0;

            Object.keys(data).forEach(date => {
                const day = data[date];

                // Tasks
                TASKS.forEach(task => {
                    if (day.tasks && day.tasks[task.id]) {
                        total += task.coins;
                    }
                });

                // Recreation
                RECREATION.forEach(task => {
                    if (day.recreation && day.recreation[task.id]) {
                        total += day.recreation[task.id] * task.coins;
                    }
                });

                // Penalties
                PENALTIES.forEach(penalty => {
                    if (day.penalties && day.penalties[penalty.id]) {
                        total += day.penalties[penalty.id] * penalty.coins;
                    }
                });
            });

            // Check bonuses
            if (checkNoCursing()) total += 25;
            if (checkRecreationStreak()) total += 30;

            return Math.max(0, total);
        }

        // Calculate today's earnings
        function calculateTodaysEarnings() {
            let todayTotal = 0;

            // Tasks
            TASKS.forEach(task => {
                if (tempData.tasks && tempData.tasks[task.id]) {
                    todayTotal += task.coins;
                }
            });

            // Recreation
            RECREATION.forEach(task => {
                if (tempData.recreation && tempData.recreation[task.id]) {
                    todayTotal += tempData.recreation[task.id] * task.coins;
                }
            });

            // Penalties
            PENALTIES.forEach(penalty => {
                if (tempData.penalties && tempData.penalties[penalty.id]) {
                    todayTotal += tempData.penalties[penalty.id] * penalty.coins;
                }
            });

            return todayTotal;
        }

        // Check no cursing bonus and get progress
        function getNoCursingProgress() {
            const lastWeek = getLastWeekDates();
            let consecutiveDaysWithoutCursing = 0;
            let hasCursedInWeek = false;

            // Check if there's been any cursing in the last 7 days
            for (let i = 0; i < lastWeek.length; i++) {
                const day = data[lastWeek[i]];
                if (day && day.penalties && (day.penalties.mild_curse || day.penalties.strong_curse)) {
                    hasCursedInWeek = true;
                    break;
                }
            }

            // Count consecutive days without cursing from today backwards
            for (let i = 0; i < lastWeek.length; i++) {
                const day = data[lastWeek[i]];
                if (!day || !day.penalties || (!day.penalties.mild_curse && !day.penalties.strong_curse)) {
                    consecutiveDaysWithoutCursing++;
                } else {
                    break; // Stop counting at first curse day
                }
            }

            return {
                current: consecutiveDaysWithoutCursing,
                target: 7,
                achieved: !hasCursedInWeek && consecutiveDaysWithoutCursing >= 7
            };
        }

        // Check no cursing bonus (legacy function)
        function checkNoCursing() {
            return getNoCursingProgress().achieved;
        }

        // Get recreation streak progress
        function getRecreationProgress() {
            const lastWeek = getLastWeekDates();
            let count = 0;
            lastWeek.forEach(date => {
                const day = data[date];
                if (day && day.recreation) {
                    // Only count BJJ class and Football game for streak
                    if (day.recreation.jj_class) {
                        count += day.recreation.jj_class;
                    }
                    if (day.recreation.football) {
                        count += day.recreation.football;
                    }
                }
            });

            return {
                current: count,
                target: 3,
                achieved: count >= 3
            };
        }

        // Check recreation streak (legacy function)
        function checkRecreationStreak() {
            return getRecreationProgress().achieved;
        }

        // Get last 7 days
        function getLastWeekDates() {
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
            }
            return dates;
        }

        // Calendar state
        let calendarMonth = new Date().getMonth();
        let calendarYear = new Date().getFullYear();

        // Toggle calendar
        function toggleCalendar() {
            const calendar = document.getElementById('calendarView');
            calendar.classList.toggle('show');
            if (calendar.classList.contains('show')) {
                renderCalendar();
            }
        }

        // Change calendar month
        function changeCalendarMonth(direction) {
            calendarMonth += direction;
            if (calendarMonth < 0) {
                calendarMonth = 11;
                calendarYear--;
            } else if (calendarMonth > 11) {
                calendarMonth = 0;
                calendarYear++;
            }
            renderCalendar();
        }

        // Render calendar
        function renderCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            document.getElementById('calendarMonth').textContent = monthNames[calendarMonth] + ' ' + calendarYear;

            const firstDay = new Date(calendarYear, calendarMonth, 1).getDay();
            const daysInMonth = new Date(calendarYear, calendarMonth + 1, 0).getDate();
            const daysInPrevMonth = new Date(calendarYear, calendarMonth, 0).getDate();

            let html = '';

            // Day headers
            dayNames.forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });

            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const date = new Date(calendarYear, calendarMonth - 1, day).toISOString().split('T')[0];
                html += renderCalendarDay(date, day, true);
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(calendarYear, calendarMonth, day).toISOString().split('T')[0];
                html += renderCalendarDay(date, day, false);
            }

            // Next month days
            const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
            const remainingCells = totalCells - (firstDay + daysInMonth);
            for (let day = 1; day <= remainingCells; day++) {
                const date = new Date(calendarYear, calendarMonth + 1, day).toISOString().split('T')[0];
                html += renderCalendarDay(date, day, true);
            }

            document.getElementById('calendarGrid').innerHTML = html;
        }

        // Render a calendar day
        function renderCalendarDay(date, dayNumber, otherMonth) {
            const today = new Date().toISOString().split('T')[0];
            const dayData = data[date];
            let dayTotal = 0;
            let classes = 'calendar-day';

            if (otherMonth) classes += ' other-month';
            if (date === today) classes += ' today';
            if (dayData) classes += ' has-data';

            if (dayData) {
                TASKS.forEach(task => {
                    if (dayData.tasks && dayData.tasks[task.id]) dayTotal += task.coins;
                });
                RECREATION.forEach(task => {
                    if (dayData.recreation && dayData.recreation[task.id]) {
                        dayTotal += dayData.recreation[task.id] * task.coins;
                    }
                });
                PENALTIES.forEach(penalty => {
                    if (dayData.penalties && dayData.penalties[penalty.id]) {
                        dayTotal += dayData.penalties[penalty.id] * penalty.coins;
                    }
                });
            }

            return `<div class="${classes}" onclick="showDayDetail('${date}')">
                <div class="calendar-day-number">${dayNumber}</div>
                ${dayTotal ? `<div class="calendar-day-coins">${dayTotal > 0 ? '+' : ''}${dayTotal}</div>` : ''}
            </div>`;
        }

        // Show day detail modal
        function showDayDetail(date) {
            const modal = document.getElementById('dayDetailModal');
            const overlay = document.getElementById('modalOverlay');
            const content = document.getElementById('dayDetailContent');
            const dayData = data[date];

            const dateObj = new Date(date + 'T00:00:00');
            const dateStr = dateObj.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            let html = `<h2 style="color: #ffD700; margin-bottom: 20px;">${dateStr}</h2>`;

            if (!dayData || (!dayData.tasks && !dayData.recreation && !dayData.penalties)) {
                html += '<p style="color: #999;">No data for this day</p>';
            } else {
                let dayTotal = 0;

                // Tasks
                const completedTasks = TASKS.filter(task => dayData.tasks && dayData.tasks[task.id]);
                if (completedTasks.length > 0) {
                    html += '<div style="margin-bottom: 15px;"><h3 style="color: #60a5fa;">‚úÖ Completed Tasks</h3>';
                    completedTasks.forEach(task => {
                        html += `<div style="padding: 5px 0;">${task.name}: +${task.coins}</div>`;
                        dayTotal += task.coins;
                    });
                    html += '</div>';
                }

                // Recreation
                const recreationDone = RECREATION.filter(task => dayData.recreation && dayData.recreation[task.id]);
                if (recreationDone.length > 0) {
                    html += '<div style="margin-bottom: 15px;"><h3 style="color: #60a5fa;">üèÉ Recreation</h3>';
                    recreationDone.forEach(task => {
                        const count = dayData.recreation[task.id];
                        html += `<div style="padding: 5px 0;">${task.name} x${count}: +${task.coins * count}</div>`;
                        dayTotal += task.coins * count;
                    });
                    html += '</div>';
                }

                // Penalties
                const penaltiesIncurred = PENALTIES.filter(penalty => dayData.penalties && dayData.penalties[penalty.id]);
                if (penaltiesIncurred.length > 0) {
                    html += '<div style="margin-bottom: 15px;"><h3 style="color: #f44336;">‚ö†Ô∏è Penalties</h3>';
                    penaltiesIncurred.forEach(penalty => {
                        const count = dayData.penalties[penalty.id];
                        html += `<div style="padding: 5px 0;">${penalty.name} x${count}: ${penalty.coins * count}</div>`;
                        dayTotal += penalty.coins * count;
                    });
                    html += '</div>';
                }

                html += `<hr style="margin: 20px 0; border-color: #666;">`;
                html += `<div style="font-size: 24px; color: #ffD700;">Day Total: ${dayTotal > 0 ? '+' : ''}${dayTotal} coins</div>`;
            }

            html += `<button onclick="selectDateFromCalendar('${date}')" style="margin-top: 20px; padding: 10px 20px; background: #2563eb; border: none; color: white; cursor: pointer; border-radius: 5px;">View This Day</button>`;

            content.innerHTML = html;
            modal.classList.add('show');
            overlay.classList.add('show');
        }

        // Close day detail modal
        function closeDayDetail() {
            document.getElementById('dayDetailModal').classList.remove('show');
            document.getElementById('modalOverlay').classList.remove('show');
        }

        // Select date from calendar
        function selectDateFromCalendar(date) {
            closeDayDetail();
            toggleCalendar();
            currentDate = date;
            initializeTempData();
            render();
        }

        // Main render function
        function render() {
            // Update total
            document.getElementById('totalCoins').textContent = calculateTotal();

            // Update today's earnings
            const todaysEarnings = calculateTodaysEarnings();
            const todaysElem = document.getElementById('todaysEarnings');
            const amountElem = document.getElementById('todaysAmount');

            if (todaysEarnings < 0) {
                todaysElem.classList.add('negative');
                amountElem.classList.add('negative');
                amountElem.textContent = todaysEarnings;
            } else {
                todaysElem.classList.remove('negative');
                amountElem.classList.remove('negative');
                amountElem.textContent = '+' + todaysEarnings;
            }

            // Update date display
            const today = new Date().toISOString().split('T')[0];
            const dateObj = new Date(currentDate);
            const dateStr = currentDate === today ? 'Today' :
                dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            document.getElementById('currentDate').textContent = dateStr;

            // Disable next button if current date
            document.getElementById('nextBtn').disabled = currentDate >= today;

            // Render tasks
            const tasksHtml = TASKS.map(task => {
                const completed = tempData.tasks[task.id];
                return `<div class="task ${completed ? 'completed' : ''}" onclick="toggleTask('${task.id}', event)">
                    <span class="task-name">${task.name}</span>
                    <span class="task-value">+${task.coins}</span>
                </div>`;
            }).join('');
            document.getElementById('tasks').innerHTML = tasksHtml;

            // Render recreation
            const recHtml = RECREATION.map(task => {
                const count = tempData.recreation[task.id] || 0;
                return `<div class="counter-task">
                    <span class="task-name">${task.name}</span>
                    <div class="counter-controls">
                        <button class="counter-btn" onclick="updateRecreation('${task.id}', -1)" ${count === 0 ? 'disabled' : ''}>-</button>
                        <span class="counter-value">${count}</span>
                        <button class="counter-btn" onclick="updateRecreation('${task.id}', 1)" ${count >= 3 ? 'disabled' : ''}>+</button>
                        <span class="task-value">+${task.coins}</span>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('recreation').innerHTML = recHtml;

            // Render penalties with counter controls
            const penHtml = PENALTIES.map(penalty => {
                const count = tempData.penalties[penalty.id] || 0;
                return `<div class="counter-task">
                    <span class="task-name">${penalty.name}</span>
                    <div class="counter-controls">
                        <button class="counter-btn" onclick="updatePenalty('${penalty.id}', -1)" ${count === 0 ? 'disabled' : ''}>-</button>
                        <span class="counter-value">${count}</span>
                        <button class="counter-btn" onclick="updatePenalty('${penalty.id}', 1)">+</button>
                        <span class="task-value" style="color: #ff6b6b">${penalty.coins}</span>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('penalties').innerHTML = penHtml;

            // Render bonuses with progress indicators
            const noCursingProgress = getNoCursingProgress();
            const recreationProgress = getRecreationProgress();

            // Check if bonuses were just achieved and throw confetti
            if (noCursingProgress.achieved && !previousBonusStates.noCursing) {
                throwConfetti();
                previousBonusStates.noCursing = true;
            } else if (!noCursingProgress.achieved) {
                previousBonusStates.noCursing = false;
            }

            if (recreationProgress.achieved && !previousBonusStates.recreation) {
                throwConfetti();
                previousBonusStates.recreation = true;
            } else if (!recreationProgress.achieved) {
                previousBonusStates.recreation = false;
            }

            const bonusHtml = `
                <div class="bonus ${noCursingProgress.achieved ? 'active' : ''}">
                    <div class="bonus-header">
                        <span>No Cursing (7 days)</span>
                        <span class="task-value">+25</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(noCursingProgress.current / noCursingProgress.target) * 100}%"></div>
                    </div>
                    <div class="progress-text">${noCursingProgress.current} / ${noCursingProgress.target} days</div>
                </div>
                <div class="bonus ${recreationProgress.achieved ? 'active' : ''}">
                    <div class="bonus-header">
                        <span>BJJ/Football Streak (3+ in 7 days)</span>
                        <span class="task-value">+30</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(100, (recreationProgress.current / recreationProgress.target) * 100)}%"></div>
                    </div>
                    <div class="progress-text">${recreationProgress.current} / ${recreationProgress.target} classes/games</div>
                </div>`;
            document.getElementById('bonuses').innerHTML = bonusHtml;

            // Update submit button state
            const submitBtn = document.getElementById('submitBtn');
            const hasChanges = checkForChanges();
            if (hasChanges) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'SUBMIT DAILY PROGRESS';
            } else {
                const savedData = data[currentDate];
                if (savedData && (Object.keys(savedData.tasks).length > 0 ||
                    Object.keys(savedData.recreation).length > 0 ||
                    Object.keys(savedData.penalties).length > 0)) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = '‚úÖ ALREADY SAVED';
                } else {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'SUBMIT DAILY PROGRESS';
                }
            }
        }

        // Check if there are unsaved changes
        function checkForChanges() {
            const savedData = data[currentDate] || { tasks: {}, recreation: {}, penalties: {} };
            return JSON.stringify(savedData) !== JSON.stringify(tempData);
        }

        // Clear all data and reset
        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL data and start fresh? This cannot be undone!')) {
                localStorage.removeItem('minecoins');
                data = {};
                tempData = {
                    tasks: {},
                    recreation: {},
                    penalties: {}
                };
                previousBonusStates = {
                    noCursing: false,
                    recreation: false
                };
                render();
                alert('All data has been cleared. Starting fresh!');
            }
        }

        // Test calculations (for debugging)
        function testCalculations() {
            console.log('=== CALCULATION TEST ===');
            console.log('Current Date:', currentDate);
            console.log('TempData:', tempData);
            console.log('Data:', data);

            const todaysEarnings = calculateTodaysEarnings();
            console.log('Today\'s Earnings:', todaysEarnings);

            const total = calculateTotal();
            console.log('Total Coins:', total);

            const noCursing = getNoCursingProgress();
            console.log('No Cursing Progress:', noCursing);

            const recreation = getRecreationProgress();
            console.log('Recreation Progress (BJJ/Football only):', recreation);

            console.log('======================');
        }

        // Initialize
        loadData();

        // Add functions to window for console access
        window.testCalc = testCalculations;
        window.clearAllData = clearAllData;
    </script>
    <script src="../js/navigation.js?v=1763735221&bust=v5"></script>
</body>
</html>