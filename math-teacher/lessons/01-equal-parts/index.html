<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Lesson 1: Equal Parts - Football Fractions</title>

  <link rel="stylesheet" href="../../styles/main.css">
  <link rel="stylesheet" href="../../styles/components.css">
  <link rel="stylesheet" href="../../styles/football-theme.css">
  <link rel="stylesheet" href="../../styles/coaches-corner.css">

  <style>
    .lesson-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .activity-section {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      margin-bottom: var(--space-xl);
      box-shadow: 0 4px 20px var(--shadow);
    }

    .activity-header {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
      padding-bottom: var(--space-md);
      border-bottom: 2px solid var(--border);
    }

    .activity-number {
      width: 40px;
      height: 40px;
      background: var(--field-green);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.25rem;
    }

    .activity-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text);
    }

    .concept-intro {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border-left: 4px solid var(--field-green);
      padding: var(--space-lg);
      border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
      margin-bottom: var(--space-xl);
    }

    .concept-intro h3 {
      color: var(--field-green);
      margin-bottom: var(--space-md);
    }

    .football-callout {
      background: linear-gradient(135deg, var(--field-green) 0%, var(--field-dark) 100%);
      color: white;
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      margin: var(--space-lg) 0;
    }

    .shapes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: var(--space-lg);
      margin: var(--space-xl) 0;
    }

    .shape-card {
      background: var(--background);
      border: 3px solid var(--border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .shape-card:hover {
      transform: scale(1.05);
      border-color: var(--field-green);
    }

    .shape-card.selected {
      border-color: var(--info);
      background: var(--info-light);
    }

    .shape-card.correct {
      border-color: var(--correct);
      background: var(--correct-light);
    }

    .shape-card.incorrect {
      border-color: var(--incorrect);
      background: var(--incorrect-light);
    }

    .shape-card svg {
      width: 100%;
      height: 80px;
      margin-bottom: var(--space-sm);
    }

    .shape-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .divide-container {
      background: var(--background);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      text-align: center;
      margin: var(--space-lg) 0;
    }

    .divide-shape {
      position: relative;
      width: 300px;
      height: 80px;
      background: var(--correct-light);
      border: 3px solid var(--field-green);
      border-radius: var(--radius-md);
      margin: var(--space-lg) auto;
      display: flex;
    }

    .divide-section {
      flex: 1;
      border-right: 2px dashed var(--field-green);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: var(--field-green);
    }

    .divide-section:last-child {
      border-right: none;
    }

    .divide-controls {
      display: flex;
      gap: var(--space-md);
      justify-content: center;
      margin-top: var(--space-lg);
    }

    .divide-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: var(--field-green);
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .divide-btn:hover {
      transform: scale(1.1);
      background: var(--field-dark);
    }

    .divide-btn:disabled {
      background: var(--border);
      cursor: not-allowed;
      transform: none;
    }

    .sorting-area {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-xl);
      margin: var(--space-xl) 0;
    }

    @media (max-width: 600px) {
      .sorting-area {
        grid-template-columns: 1fr;
      }
    }

    .sort-bin {
      background: var(--background);
      border: 3px dashed var(--border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      min-height: 200px;
      transition: all var(--transition-fast);
    }

    .sort-bin.equal-bin {
      border-color: var(--correct);
    }

    .sort-bin.not-equal-bin {
      border-color: var(--incorrect);
    }

    .sort-bin.drag-over {
      background: var(--info-light);
      transform: scale(1.02);
    }

    .sort-bin-title {
      text-align: center;
      font-weight: 700;
      margin-bottom: var(--space-md);
      padding-bottom: var(--space-sm);
      border-bottom: 2px solid var(--border);
    }

    .sort-bin.equal-bin .sort-bin-title {
      color: var(--correct);
    }

    .sort-bin.not-equal-bin .sort-bin-title {
      color: var(--incorrect);
    }

    .sort-items {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-md);
      justify-content: center;
      min-height: 100px;
    }

    .sort-item {
      width: 80px;
      height: 60px;
      background: white;
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      cursor: grab;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      touch-action: none;
    }

    .sort-item:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px var(--shadow);
    }

    .sort-item.dragging {
      opacity: 0.8;
      cursor: grabbing;
      position: fixed;
      z-index: 1000;
      pointer-events: none;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      transform: scale(1.1);
    }

    .sort-item svg {
      width: 60px;
      height: 40px;
    }

    .unsorted-area {
      background: var(--info-light);
      border: 2px solid var(--info);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      margin-bottom: var(--space-xl);
    }

    .unsorted-title {
      text-align: center;
      color: var(--info);
      font-weight: 700;
      margin-bottom: var(--space-md);
    }

    /* Football Field Progress Bar */
    .field-progress {
      background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
      border-radius: var(--radius-xl);
      padding: var(--space-lg);
      margin-bottom: var(--space-xl);
      box-shadow: 0 4px 20px var(--shadow);
    }

    .field-matchup {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-md);
    }

    .field-team {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .field-team-logo {
      width: 40px;
      height: 40px;
      object-fit: contain;
    }

    .field-team-name {
      color: white;
      font-weight: 700;
      font-size: 0.875rem;
    }

    .field-vs {
      color: #888;
      font-weight: 700;
      font-size: 0.75rem;
    }

    .field-container {
      position: relative;
      height: 50px;
      background: linear-gradient(90deg,
        var(--eagles-green, #004C54) 0%,
        var(--eagles-green, #004C54) 10%,
        var(--field-green) 10%,
        var(--field-green) 90%,
        var(--opponent-color, #002244) 90%,
        var(--opponent-color, #002244) 100%);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .field-yard-markers {
      position: absolute;
      top: 0;
      left: 10%;
      right: 10%;
      height: 100%;
      display: flex;
      justify-content: space-between;
    }

    .field-yard-marker {
      width: 2px;
      height: 100%;
      background: rgba(255,255,255,0.3);
    }

    .field-yard-labels {
      display: flex;
      justify-content: space-between;
      padding: 0 10%;
      margin-top: var(--space-xs);
    }

    .field-yard-label {
      color: #888;
      font-size: 0.625rem;
      font-weight: 600;
    }

    .field-football {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5rem;
      transition: left 0.5s ease;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
      z-index: 10;
    }

    .field-end-zone {
      position: absolute;
      top: 0;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 900;
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .field-end-zone.eagles {
      left: 0;
      width: 10%;
      background: var(--eagles-green, #004C54);
    }

    .field-end-zone.opponent {
      right: 0;
      width: 10%;
      background: var(--opponent-color, #002244);
    }

    .field-status {
      text-align: center;
      color: #888;
      font-size: 0.75rem;
      margin-top: var(--space-sm);
    }

    .field-status strong {
      color: white;
    }

    :root {
      --eagles-green: #004C54;
      --opponent-color: #002244; /* Cowboys blue */
    }

    .feedback {
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      text-align: center;
      font-weight: 700;
      margin: var(--space-lg) 0;
      display: none;
    }

    .feedback.correct {
      background: var(--correct-light);
      color: var(--correct);
      display: block;
    }

    .feedback.incorrect {
      background: var(--incorrect-light);
      color: var(--incorrect);
      display: block;
    }

    .feedback.info {
      background: var(--info-light);
      color: var(--info);
      display: block;
    }

    .lesson-nav {
      display: flex;
      justify-content: space-between;
      margin-top: var(--space-2xl);
      margin-bottom: var(--space-2xl);
      padding-top: var(--space-lg);
      border-top: 1px solid var(--border);
    }

    .score-display {
      display: flex;
      gap: var(--space-xl);
      justify-content: center;
      background: var(--background);
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-xl);
    }

    .score-item {
      text-align: center;
    }

    .score-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--field-green);
    }

    .score-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .activity-complete {
      text-align: center;
      padding: var(--space-xl);
      background: var(--correct-light);
      border-radius: var(--radius-lg);
      display: none;
    }

    .activity-complete.show {
      display: block;
    }

    .activity-complete h3 {
      color: var(--correct);
      margin-bottom: var(--space-md);
    }

    .check-btn {
      margin-top: var(--space-lg);
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="nav-container">
      <a href="../../index.html" class="nav-brand">
        <span>üèà</span>
        <span>Football Fractions</span>
      </a>
      <button class="nav-hamburger" id="navHamburger" aria-label="Toggle menu">‚ò∞</button>
      <ul class="nav-menu" id="navMenu">
        <li><a href="../../index.html" class="nav-link">Home</a></li>
        <li><a href="../../practice/index.html" class="nav-link">Practice</a></li>
        <li><a href="../../lessons/index.html" class="nav-link active">Game Time</a></li>
        <li class="nav-item">
          <a href="#" class="nav-link">
            Parents Stuff <span class="dropdown-arrow">‚ñº</span>
          </a>
          <ul class="nav-dropdown">
            <li><a href="../../parent-guide/index.html" class="nav-dropdown-link">Parent Guide</a></li>
            <li><a href="../../super-extra-curricular/index.html" class="nav-dropdown-link">Super Extra</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </nav>

  <header class="page-header">
    <div class="container">
      <div class="breadcrumb breadcrumb-light">
        <a href="../index.html">Lessons</a>
        <span>></span>
        <span>Lesson 1</span>
      </div>
      <h1>Lesson 1: Equal Parts</h1>
      <p>What makes parts TRULY equal?</p>
    </div>
  </header>

  <main class="container">
    <div class="lesson-container">
      <!-- Football Field Progress Bar -->
      <div class="field-progress">
        <div class="field-matchup">
          <div class="field-team">
            <img src="../../images/nfl-logos/eagles.png" alt="Eagles" class="field-team-logo">
            <span class="field-team-name">Eagles</span>
          </div>
          <span class="field-vs">WILD CARD ROUND</span>
          <div class="field-team">
            <span class="field-team-name">Cowboys</span>
            <img src="../../images/nfl-logos/cowboys.png" alt="Cowboys" class="field-team-logo">
          </div>
        </div>
        <div class="field-container">
          <div class="field-end-zone eagles">GO</div>
          <div class="field-yard-markers">
            <div class="field-yard-marker"></div>
            <div class="field-yard-marker"></div>
            <div class="field-yard-marker"></div>
            <div class="field-yard-marker"></div>
            <div class="field-yard-marker"></div>
          </div>
          <div class="field-football" id="footballPosition" style="left: 10%;">üèà</div>
          <div class="field-end-zone opponent">TD</div>
        </div>
        <div class="field-yard-labels">
          <span class="field-yard-label">0</span>
          <span class="field-yard-label">25</span>
          <span class="field-yard-label">50</span>
          <span class="field-yard-label">75</span>
          <span class="field-yard-label">100</span>
        </div>
        <div class="field-status">
          <span id="yardsDisplay"><strong>0</strong> yards gained ‚Ä¢ <strong>100</strong> yards to TD</span>
        </div>
      </div>

      <!-- Score Display -->
      <div class="score-display">
        <div class="score-item">
          <div class="score-value" id="scoreValue">0</div>
          <div class="score-label">Points</div>
        </div>
        <div class="score-item">
          <div class="score-value" id="activityNum">1</div>
          <div class="score-label">of 3 Activities</div>
        </div>
      </div>

      <!-- Concept Introduction -->
      <div class="concept-intro">
        <h3>Coach's Lesson: What Are Equal Parts?</h3>
        <p><strong>The WHY:</strong> Equal parts matter because fractions only work when every piece is the EXACT same size. If you cut a pizza into "halves" but one piece is bigger, that's not fair - and it's not really halves!</p>
        <p style="margin-top: var(--space-md);"><strong>The Rule:</strong> When you divide something into pieces, those pieces are "equal" only if they're the <strong>EXACT same size</strong>. Not "kinda the same" or "close enough" - they have to be EXACTLY the same!</p>
        <p style="margin-top: var(--space-md);"><strong>How to Check:</strong> Imagine cutting out each piece and stacking them. If they match up perfectly, they're equal. If one hangs over the edge, they're NOT equal.</p>
        <div class="football-callout" style="margin-top: var(--space-lg);">
          <strong>Football Connection:</strong> Picture a football field - it's 100 yards, marked every 10 yards. Each section is EXACTLY 10 yards, not 9 here and 11 there. When <strong>Jalen Hurts</strong> throws to <strong>A.J. Brown</strong>, they know EXACTLY how far to run because those yard lines are equal parts. Coach <strong>Nick Sirianni</strong> divides practice time so each drill gets the SAME amount - that's fair. The Eagles win because they understand equal parts. The Cowboys? Let's just say their playbook might not be divided so perfectly...
        </div>
      </div>

      <!-- Activity 1: Spot the Equal Parts -->
      <div class="activity-section" id="activity1">
        <div class="activity-header">
          <div class="activity-number">1</div>
          <div class="activity-title">Spot the Equal Parts</div>
        </div>
        <p>Click on ALL the shapes that are divided into <strong>truly equal parts</strong>. Be careful - some look close but aren't equal!</p>

        <div class="shapes-grid" id="shapesGrid">
          <!-- Shapes will be rendered by JS -->
        </div>

        <div class="feedback" id="feedback1"></div>

        <button class="btn btn-primary btn-large check-btn" id="checkBtn1" onclick="Lesson.checkActivity1()">Check My Answers</button>

        <div class="activity-complete" id="complete1">
          <h3>Great Job!</h3>
          <p>You correctly identified the equal parts!</p>
          <button class="btn btn-primary" onclick="Lesson.showActivity(2)">Continue to Activity 2</button>
        </div>
      </div>

      <!-- Activity 2: Divide the Shape -->
      <div class="activity-section" id="activity2" style="display: none;">
        <div class="activity-header">
          <div class="activity-number">2</div>
          <div class="activity-title">Divide the Bar</div>
        </div>
        <p>Use the + and - buttons to divide this bar into the number of <strong>equal parts</strong> shown. Watch how the parts change!</p>

        <div id="divideChallenge">
          <!-- Will be rendered by JS -->
        </div>

        <div class="feedback" id="feedback2"></div>

        <div class="activity-complete" id="complete2">
          <h3>Perfect Division!</h3>
          <p>You understand how to create equal parts!</p>
          <button class="btn btn-primary" onclick="Lesson.showActivity(3)">Continue to Activity 3</button>
        </div>
      </div>

      <!-- Activity 3: Sort the Shapes -->
      <div class="activity-section" id="activity3" style="display: none;">
        <div class="activity-header">
          <div class="activity-number">3</div>
          <div class="activity-title">Sort Equal vs Not Equal</div>
        </div>
        <p>Drag each shape into the correct bin. Does it have equal parts or not?</p>

        <div class="unsorted-area" id="unsortedArea">
          <div class="unsorted-title">Drag these shapes to the correct bin:</div>
          <div class="sort-items" id="unsortedItems">
            <!-- Items will be rendered by JS -->
          </div>
        </div>

        <div class="sorting-area">
          <div class="sort-bin equal-bin" id="equalBin">
            <div class="sort-bin-title">Equal Parts</div>
            <div class="sort-items" id="equalItems"></div>
          </div>
          <div class="sort-bin not-equal-bin" id="notEqualBin">
            <div class="sort-bin-title">NOT Equal Parts</div>
            <div class="sort-items" id="notEqualItems"></div>
          </div>
        </div>

        <div class="feedback" id="feedback3"></div>

        <button class="btn btn-primary btn-large check-btn" id="checkBtn3" onclick="Lesson.checkActivity3()">Check My Sorting</button>

        <div class="activity-complete" id="complete3">
          <h3>Lesson Complete!</h3>
          <p>You now understand equal parts - the foundation of fractions!</p>
          <button class="btn btn-success btn-large" onclick="Lesson.completeLesson()">Finish Lesson</button>
        </div>
      </div>

      <!-- Lesson Navigation -->
      <div class="lesson-nav">
        <span class="text-muted">‚Üê First Lesson</span>
        <a href="../02-improper-fractions/index.html" class="btn btn-secondary">Next: Improper Fractions ‚Üí</a>
      </div>
    </div>
  </main>

  <script src="../../js/storage.js"></script>
  <script src="../../js/fractions.js"></script>
  <script src="../../js/app.js"></script>
  <script src="../../js/coaches-corner.js"></script>
  <script>
    const Lesson = {
      score: 0,
      currentActivity: 1,
      totalActivities: 3,

      // Activity 1 data - shapes to identify
      activity1Shapes: [
        { id: 1, isEqual: true, svg: '<rect x="2" y="10" width="76" height="40" fill="#e8f5e9" stroke="#2E7D32" stroke-width="2"/><line x1="40" y1="10" x2="40" y2="50" stroke="#2E7D32" stroke-width="1.5"/>', label: 'Halves' },
        { id: 2, isEqual: false, svg: '<rect x="2" y="10" width="76" height="40" fill="#fff3e0" stroke="#E65100" stroke-width="2"/><line x1="25" y1="10" x2="25" y2="50" stroke="#E65100" stroke-width="1.5"/>', label: 'Two parts' },
        { id: 3, isEqual: true, svg: '<rect x="2" y="10" width="76" height="40" fill="#e8f5e9" stroke="#2E7D32" stroke-width="2"/><line x1="20" y1="10" x2="20" y2="50" stroke="#2E7D32" stroke-width="1"/><line x1="40" y1="10" x2="40" y2="50" stroke="#2E7D32" stroke-width="1"/><line x1="60" y1="10" x2="60" y2="50" stroke="#2E7D32" stroke-width="1"/>', label: 'Fourths' },
        { id: 4, isEqual: false, svg: '<rect x="2" y="10" width="76" height="40" fill="#fff3e0" stroke="#E65100" stroke-width="2"/><line x1="40" y1="10" x2="40" y2="50" stroke="#E65100" stroke-width="1"/><line x1="40" y1="30" x2="78" y2="30" stroke="#E65100" stroke-width="1"/>', label: 'Three parts' },
        { id: 5, isEqual: true, svg: '<circle cx="40" cy="30" r="25" fill="#e8f5e9" stroke="#2E7D32" stroke-width="2"/><line x1="40" y1="5" x2="40" y2="55" stroke="#2E7D32" stroke-width="1.5"/>', label: 'Circle halves' },
        { id: 6, isEqual: false, svg: '<circle cx="40" cy="30" r="25" fill="#fff3e0" stroke="#E65100" stroke-width="2"/><line x1="40" y1="5" x2="40" y2="55" stroke="#E65100" stroke-width="1"/><line x1="40" y1="30" x2="65" y2="30" stroke="#E65100" stroke-width="1"/>', label: 'Circle parts' },
      ],
      activity1Selected: new Set(),

      // Activity 2 data - divide challenges
      divideGoals: [2, 4, 3],
      currentDivideIndex: 0,
      currentDivisions: 1,

      // Activity 3 data - sorting
      activity3Shapes: [
        { id: 's1', isEqual: true, svg: '<rect x="2" y="5" width="56" height="30" fill="#e8f5e9" stroke="#2E7D32" stroke-width="2"/><line x1="30" y1="5" x2="30" y2="35" stroke="#2E7D32" stroke-width="1.5"/>' },
        { id: 's2', isEqual: false, svg: '<rect x="2" y="5" width="56" height="30" fill="#fff3e0" stroke="#E65100" stroke-width="2"/><line x1="20" y1="5" x2="20" y2="35" stroke="#E65100" stroke-width="1.5"/>' },
        { id: 's3', isEqual: true, svg: '<rect x="2" y="5" width="56" height="30" fill="#e8f5e9" stroke="#2E7D32" stroke-width="2"/><line x1="15" y1="5" x2="15" y2="35" stroke="#2E7D32" stroke-width="1"/><line x1="30" y1="5" x2="30" y2="35" stroke="#2E7D32" stroke-width="1"/><line x1="45" y1="5" x2="45" y2="35" stroke="#2E7D32" stroke-width="1"/>' },
        { id: 's4', isEqual: false, svg: '<rect x="2" y="5" width="56" height="30" fill="#fff3e0" stroke="#E65100" stroke-width="2"/><line x1="30" y1="5" x2="30" y2="35" stroke="#E65100" stroke-width="1"/><line x1="45" y1="5" x2="45" y2="35" stroke="#E65100" stroke-width="1"/>' },
        { id: 's5', isEqual: true, svg: '<circle cx="30" cy="20" r="15" fill="#e8f5e9" stroke="#2E7D32" stroke-width="2"/><line x1="15" y1="20" x2="45" y2="20" stroke="#2E7D32" stroke-width="1.5"/>' },
        { id: 's6', isEqual: false, svg: '<circle cx="30" cy="20" r="15" fill="#fff3e0" stroke="#E65100" stroke-width="2"/><line x1="30" y1="5" x2="30" y2="35" stroke="#E65100" stroke-width="1"/><line x1="30" y1="20" x2="45" y2="20" stroke="#E65100" stroke-width="1"/>' },
      ],
      sortedItems: { equal: [], notEqual: [] },

      init() {
        Storage.startLesson(1);
        this.renderActivity1();
        this.renderActivity2();
        this.renderActivity3();
        this.setupDragAndDrop();
        this.updateProgress();
      },

      renderActivity1() {
        const grid = document.getElementById('shapesGrid');
        grid.innerHTML = this.activity1Shapes.map(shape => `
          <div class="shape-card" data-id="${shape.id}" onclick="Lesson.toggleShape(${shape.id})">
            <svg viewBox="0 0 80 60">${shape.svg}</svg>
            <div class="shape-label">${shape.label}</div>
          </div>
        `).join('');
      },

      toggleShape(id) {
        if (this.activity1Selected.has(id)) {
          this.activity1Selected.delete(id);
        } else {
          this.activity1Selected.add(id);
        }

        // Update visual
        const card = document.querySelector(`[data-id="${id}"]`);
        card.classList.toggle('selected', this.activity1Selected.has(id));

        // Clear previous feedback
        document.getElementById('feedback1').className = 'feedback';
      },

      checkActivity1() {
        const correctIds = this.activity1Shapes.filter(s => s.isEqual).map(s => s.id);
        const selectedArray = Array.from(this.activity1Selected);

        const allCorrectSelected = correctIds.every(id => selectedArray.includes(id));
        const noIncorrectSelected = selectedArray.every(id => correctIds.includes(id));

        const feedback = document.getElementById('feedback1');

        if (allCorrectSelected && noIncorrectSelected) {
          feedback.textContent = "Perfect! You found all the shapes with equal parts!";
          feedback.className = 'feedback correct';
          this.score += 10;
          this.updateScore();
          document.getElementById('checkBtn1').style.display = 'none';
          document.getElementById('complete1').classList.add('show');

          // Mark shapes
          this.activity1Shapes.forEach(shape => {
            const card = document.querySelector(`[data-id="${shape.id}"]`);
            card.classList.remove('selected');
            card.classList.add(shape.isEqual ? 'correct' : 'incorrect');
          });
        } else if (selectedArray.length === 0) {
          feedback.textContent = "Click on the shapes that have equal parts, then check again!";
          feedback.className = 'feedback info';
        } else {
          feedback.textContent = "Not quite! Remember: equal parts must be the EXACT same size. Try again!";
          feedback.className = 'feedback incorrect';
        }
      },

      renderActivity2() {
        const container = document.getElementById('divideChallenge');
        this.renderDivideChallenge(container);
      },

      renderDivideChallenge(container) {
        const goal = this.divideGoals[this.currentDivideIndex];
        container.innerHTML = `
          <div class="divide-container">
            <p style="font-size: 1.25rem; margin-bottom: var(--space-md);">
              Divide this bar into <strong style="color: var(--field-green); font-size: 1.5rem;">${goal}</strong> equal parts
            </p>

            <div class="divide-shape" id="divideShape">
              ${this.renderDivideSections()}
            </div>

            <p style="margin-top: var(--space-md);">
              Current: <strong>${this.currentDivisions}</strong> part${this.currentDivisions > 1 ? 's' : ''}
            </p>

            <div class="divide-controls">
              <button class="divide-btn" onclick="Lesson.changeDivisions(-1)" ${this.currentDivisions <= 1 ? 'disabled' : ''}>-</button>
              <button class="divide-btn" onclick="Lesson.changeDivisions(1)" ${this.currentDivisions >= 8 ? 'disabled' : ''}>+</button>
            </div>

            <button class="btn btn-primary" id="submitDivide" onclick="Lesson.checkDivide()" style="margin-top: var(--space-lg);">Submit Answer</button>
          </div>
        `;
      },

      renderDivideSections() {
        let html = '';
        for (let i = 0; i < this.currentDivisions; i++) {
          html += `<div class="divide-section">1/${this.currentDivisions}</div>`;
        }
        return html;
      },

      changeDivisions(delta) {
        this.currentDivisions = Math.max(1, Math.min(8, this.currentDivisions + delta));
        this.renderActivity2();
      },

      checkDivide() {
        const goal = this.divideGoals[this.currentDivideIndex];
        const feedback = document.getElementById('feedback2');

        if (this.currentDivisions === goal) {
          feedback.textContent = `Yes! You divided it into ${goal} equal parts!`;
          feedback.className = 'feedback correct';
          this.score += 5;
          this.updateScore();

          setTimeout(() => {
            this.currentDivideIndex++;
            if (this.currentDivideIndex < this.divideGoals.length) {
              this.currentDivisions = 1;
              feedback.className = 'feedback';
              this.renderActivity2();
            } else {
              document.getElementById('complete2').classList.add('show');
            }
          }, 1500);
        } else {
          feedback.textContent = `Not quite! You have ${this.currentDivisions} parts, but need ${goal} equal parts.`;
          feedback.className = 'feedback incorrect';
        }
      },

      renderActivity3() {
        const container = document.getElementById('unsortedItems');
        // Shuffle the shapes
        const shuffled = [...this.activity3Shapes].sort(() => Math.random() - 0.5);
        container.innerHTML = shuffled.map(shape => `
          <div class="sort-item" data-id="${shape.id}" data-equal="${shape.isEqual}">
            <svg viewBox="0 0 60 40">${shape.svg}</svg>
          </div>
        `).join('');
      },

      setupDragAndDrop() {
        let draggedItem = null;
        let offsetX = 0;
        let offsetY = 0;
        let placeholder = null;

        const startDrag = (item, clientX, clientY) => {
          draggedItem = item;
          const rect = item.getBoundingClientRect();
          offsetX = clientX - rect.left;
          offsetY = clientY - rect.top;

          // Create placeholder to maintain layout
          placeholder = document.createElement('div');
          placeholder.style.width = rect.width + 'px';
          placeholder.style.height = rect.height + 'px';
          placeholder.style.visibility = 'hidden';
          item.parentNode.insertBefore(placeholder, item);

          // Position the item at its current location
          draggedItem.style.left = rect.left + 'px';
          draggedItem.style.top = rect.top + 'px';
          draggedItem.style.width = rect.width + 'px';
          draggedItem.style.height = rect.height + 'px';
          draggedItem.classList.add('dragging');
        };

        const moveDrag = (clientX, clientY) => {
          if (!draggedItem) return;
          draggedItem.style.left = (clientX - offsetX) + 'px';
          draggedItem.style.top = (clientY - offsetY) + 'px';

          // Highlight drop target
          const elementBelow = document.elementFromPoint(clientX, clientY);
          const bin = elementBelow?.closest('.sort-bin');
          document.querySelectorAll('.sort-bin').forEach(b => b.classList.remove('drag-over'));
          if (bin) {
            bin.classList.add('drag-over');
          }
        };

        const endDrag = (clientX, clientY) => {
          if (!draggedItem) return;

          const dropTarget = document.elementFromPoint(clientX, clientY);
          const bin = dropTarget?.closest('.sort-bin');

          // Remove placeholder
          if (placeholder && placeholder.parentNode) {
            placeholder.parentNode.removeChild(placeholder);
            placeholder = null;
          }

          // Clear all drag-over states
          document.querySelectorAll('.sort-bin').forEach(b => b.classList.remove('drag-over'));

          if (bin) {
            const itemsContainer = bin.querySelector('.sort-items');
            if (itemsContainer) {
              itemsContainer.appendChild(draggedItem);

              const itemId = draggedItem.dataset.id;
              const isEqualBin = bin.classList.contains('equal-bin');

              this.sortedItems.equal = this.sortedItems.equal.filter(id => id !== itemId);
              this.sortedItems.notEqual = this.sortedItems.notEqual.filter(id => id !== itemId);

              if (isEqualBin) {
                this.sortedItems.equal.push(itemId);
              } else {
                this.sortedItems.notEqual.push(itemId);
              }
            }
          }

          // Reset inline styles
          draggedItem.style.left = '';
          draggedItem.style.top = '';
          draggedItem.style.width = '';
          draggedItem.style.height = '';
          draggedItem.classList.remove('dragging');
          draggedItem = null;
        };

        // Mouse support
        document.addEventListener('mousedown', (e) => {
          const item = e.target.closest('.sort-item');
          if (item) {
            e.preventDefault();
            startDrag(item, e.clientX, e.clientY);
          }
        });

        document.addEventListener('mousemove', (e) => {
          if (draggedItem) {
            e.preventDefault();
            moveDrag(e.clientX, e.clientY);
          }
        });

        document.addEventListener('mouseup', (e) => {
          if (draggedItem) {
            endDrag(e.clientX, e.clientY);
          }
        });

        // Touch support
        document.addEventListener('touchstart', (e) => {
          const item = e.target.closest('.sort-item');
          if (item) {
            e.preventDefault();
            startDrag(item, e.touches[0].clientX, e.touches[0].clientY);
          }
        }, { passive: false });

        document.addEventListener('touchmove', (e) => {
          if (draggedItem) {
            e.preventDefault();
            moveDrag(e.touches[0].clientX, e.touches[0].clientY);
          }
        }, { passive: false });

        document.addEventListener('touchend', (e) => {
          if (draggedItem) {
            const touch = e.changedTouches[0];
            endDrag(touch.clientX, touch.clientY);
          }
        });
      },

      checkActivity3() {
        const unsorted = document.getElementById('unsortedItems').children.length;

        if (unsorted > 0) {
          const feedback = document.getElementById('feedback3');
          feedback.textContent = "Sort all the shapes into bins first!";
          feedback.className = 'feedback info';
          return;
        }

        let allCorrect = true;

        // Check equal bin
        this.sortedItems.equal.forEach(id => {
          const shape = this.activity3Shapes.find(s => s.id === id);
          if (!shape.isEqual) allCorrect = false;
        });

        // Check not equal bin
        this.sortedItems.notEqual.forEach(id => {
          const shape = this.activity3Shapes.find(s => s.id === id);
          if (shape.isEqual) allCorrect = false;
        });

        const feedback = document.getElementById('feedback3');

        if (allCorrect) {
          feedback.textContent = "Amazing! You sorted all the shapes correctly!";
          feedback.className = 'feedback correct';
          this.score += 15;
          this.updateScore();
          document.getElementById('checkBtn3').style.display = 'none';
          document.getElementById('complete3').classList.add('show');
        } else {
          feedback.textContent = "Some shapes are in the wrong bin. Look carefully at whether the parts are the same size!";
          feedback.className = 'feedback incorrect';
        }
      },

      showActivity(num) {
        for (let i = 1; i <= this.totalActivities; i++) {
          document.getElementById(`activity${i}`).style.display = 'none';
        }

        document.getElementById(`activity${num}`).style.display = 'block';
        this.currentActivity = num;
        document.getElementById('activityNum').textContent = num;
        this.updateProgress();

        window.scrollTo({ top: 0, behavior: 'smooth' });
      },

      updateScore() {
        document.getElementById('scoreValue').textContent = this.score;
      },

      updateProgress() {
        // Calculate field position (10% = start, 90% = touchdown)
        const progressPercent = (this.currentActivity - 1) / this.totalActivities;
        const fieldPosition = 10 + (progressPercent * 80); // 10% to 90%
        const yards = Math.round(progressPercent * 100);

        document.getElementById('footballPosition').style.left = `${fieldPosition}%`;
        document.getElementById('yardsDisplay').innerHTML =
          `<strong>${yards}</strong> yards gained ‚Ä¢ <strong>${100 - yards}</strong> yards to TD`;
      },

      completeLesson() {
        Storage.completeLesson(1);

        // Move football to end zone
        document.getElementById('footballPosition').style.left = '90%';
        document.getElementById('yardsDisplay').innerHTML = '<strong>TOUCHDOWN!</strong>';

        // Trigger victory celebration
        setTimeout(() => {
          App.celebrateVictory('Cowboys', 1, '../../images/nfl-logos/cowboys.png');
        }, 500);
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      Lesson.init();
      CoachesCorner.init(1);
    });
  </script>
</body>
</html>
