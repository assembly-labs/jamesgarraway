<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecoins Tracker</title>

    <!-- Preload background image for faster loading -->
    <link rel="preload" as="image" href="minecraft-bg.png">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: monospace;
            background: #5a9fd4;
            color: white;
            padding: 20px;
            font-size: 18px;
            min-height: 100vh;
            position: relative;
        }

        /* Background image with overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            opacity: 0;
            z-index: -2;
            transition: opacity 0.5s ease;
        }

        /* Only show background when loaded */
        body.bg-loaded::before {
            background-image: url('minecraft-bg.png');
            opacity: 1;
        }

        /* Dark overlay for readability */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: -1;
        }


        .container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Header with total */
        .header {
            background: rgba(51, 51, 51, 0.95);
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .total-coins {
            font-size: 48px;
            color: #ffD700;
            margin: 10px 0;
        }

        .date-nav {
            background: rgba(68, 68, 68, 0.95);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .date-btn {
            background: #666;
            border: 2px solid #333;
            color: white;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
        }

        .date-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .current-date {
            font-size: 20px;
            font-weight: bold;
        }

        /* Sections */
        .section {
            background: rgba(68, 68, 68, 0.95);
            padding: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 24px;
            color: #ffD700;
            margin-bottom: 15px;
        }

        /* Tasks */
        .task {
            background: #666;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .task.completed {
            background: #4ade80;
        }

        .task-name {
            font-size: 18px;
        }

        .task-value {
            color: #ffD700;
            font-weight: bold;
        }

        /* Counter tasks */
        .counter-task {
            background: #666;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .counter-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .counter-btn {
            background: #888;
            border: 2px solid #333;
            color: white;
            width: 35px;
            height: 35px;
            font-size: 20px;
            cursor: pointer;
        }

        .counter-btn:disabled {
            opacity: 0.5;
        }

        .counter-value {
            font-size: 20px;
            color: #ffD700;
            min-width: 30px;
            text-align: center;
        }

        /* Penalties */
        .penalty-btn {
            background: #d32f2f;
            border: 2px solid #b71c1c;
            color: white;
            padding: 12px;
            margin-bottom: 10px;
            font-size: 18px;
            cursor: pointer;
            display: block;
            width: 100%;
        }

        .penalty-count {
            float: right;
            background: #b71c1c;
            padding: 2px 8px;
            border-radius: 3px;
        }

        /* Bonuses */
        .bonus {
            background: #666;
            padding: 12px;
            margin-bottom: 10px;
        }

        .bonus.active {
            background: #4ade80;
        }

        .bonus-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-bar {
            background: #333;
            height: 20px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            background: #ffD700;
            height: 100%;
            transition: width 0.3s;
        }

        .progress-text {
            font-size: 14px;
            color: #ccc;
            margin-top: 5px;
        }

        /* Buttons */
        .calendar-btn {
            background: #666;
            border: 2px solid #333;
            color: white;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
        }

        .submit-btn {
            background: #4ade80;
            border: 2px solid #22c55e;
            color: #333;
            padding: 15px 30px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 30px;
        }

        .submit-btn:disabled {
            background: #888;
            border-color: #666;
            color: #555;
            cursor: not-allowed;
        }

        .saved-indicator {
            background: #22c55e;
            color: white;
            padding: 10px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 3px;
        }

        .history {
            display: none;
            background: #444;
            padding: 15px;
            margin-bottom: 20px;
        }

        .history.show {
            display: block;
        }

        .history-day {
            background: #666;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
        }

        .history-day:hover {
            background: #777;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with total -->
        <div class="header">
            <div>TOTAL MINECOINS</div>
            <div class="total-coins" id="totalCoins">0</div>
        </div>

        <!-- Date Navigation -->
        <div class="date-nav">
            <button class="date-btn" onclick="changeDate(-1)">‚Üê</button>
            <div class="current-date" id="currentDate">Today</div>
            <button class="date-btn" id="nextBtn" onclick="changeDate(1)">‚Üí</button>
        </div>

        <!-- Calendar Toggle -->
        <button class="calendar-btn" onclick="toggleHistory()">üìÖ View History</button>

        <!-- History -->
        <div class="history" id="history"></div>

        <!-- Tasks Section -->
        <div class="section">
            <div class="section-title">‚úÖ TASKS</div>
            <div id="tasks"></div>
        </div>

        <!-- Recreation Section -->
        <div class="section">
            <div class="section-title">üèÉ RECREATION</div>
            <div id="recreation"></div>
        </div>

        <!-- Penalties Section -->
        <div class="section">
            <div class="section-title">‚ö†Ô∏è PENALTIES</div>
            <div id="penalties"></div>
        </div>

        <!-- Bonuses Section -->
        <div class="section">
            <div class="section-title">üèÜ BONUSES</div>
            <div id="bonuses"></div>
        </div>

        <!-- Saved Indicator -->
        <div class="saved-indicator" id="savedIndicator" style="display: none;">
            ‚úÖ Daily Progress Saved!
        </div>

        <!-- Submit Button -->
        <button class="submit-btn" id="submitBtn" onclick="submitDailyProgress()">
            SUBMIT DAILY PROGRESS
        </button>
    </div>

    <script>
        // Preload and cache the background image
        const bgImage = new Image();
        bgImage.onload = function() {
            document.body.classList.add('bg-loaded');
        };
        bgImage.src = 'minecraft-bg.png';

        // Task definitions
        const TASKS = [
            { id: 'make_bed', name: 'Make Bed', coins: 5 },
            { id: 'help_dishes', name: 'Help with Dishes', coins: 5 },
            { id: 'clean_room', name: 'Clean Room', coins: 5 },
            { id: 'listen_first', name: 'Listen First Time', coins: 5 },
            { id: 'fill_bucket', name: "Fill Someone's Bucket", coins: 10 },
            { id: 'meditate', name: 'Meditate (5+ min)', coins: 20 },
            { id: 'help_without', name: 'Help Without Being Asked', coins: 10 },
            { id: 'trash', name: 'Take Out Trash', coins: 15 },
            { id: 'vacuum', name: 'Vacuum a Room', coins: 15 },
            { id: 'special', name: 'Special Project', coins: 30 }
        ];

        const RECREATION = [
            { id: 'jj_class', name: 'ü•ã Jiu-Jitsu Class', coins: 5 },
            { id: 'jj_respect', name: 'ü•ã Respect BJJ Coach', coins: 10 },
            { id: 'football', name: 'üèà Football Game', coins: 5 },
            { id: 'football_coach', name: 'üèà Listen to Football Coach', coins: 10 },
            { id: 'support_team', name: 'üèà Support the Team', coins: 10 }
        ];

        const PENALTIES = [
            { id: 'mild_curse', name: 'Mild Curse', coins: -5 },
            { id: 'strong_curse', name: 'Strong Curse', coins: -10 },
            { id: 'talking_back', name: 'Talking Back', coins: -5 },
            { id: 'not_listening', name: 'Not Listening', coins: -10 },
            { id: 'yelling', name: 'Yelling/Disrespect', coins: -10 }
        ];

        // State
        let data = {};
        let tempData = {}; // Temporary data for current day until submitted
        let currentDate = new Date().toISOString().split('T')[0];

        // Load data
        function loadData() {
            const stored = localStorage.getItem('minecoins');
            if (stored) {
                data = JSON.parse(stored);
            }
            // Initialize temp data for current date
            initializeTempData();
            render();
        }

        // Initialize temporary data for current date
        function initializeTempData() {
            if (data[currentDate]) {
                // Copy existing data to temp
                tempData = JSON.parse(JSON.stringify(data[currentDate]));
            } else {
                tempData = {
                    tasks: {},
                    recreation: {},
                    penalties: {}
                };
            }
        }

        // Submit daily progress
        function submitDailyProgress() {
            // Save tempData to permanent data
            data[currentDate] = JSON.parse(JSON.stringify(tempData));
            localStorage.setItem('minecoins', JSON.stringify(data));

            // Show saved indicator
            const indicator = document.getElementById('savedIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);

            render();
        }

        // Change date
        function changeDate(direction) {
            const date = new Date(currentDate);
            date.setDate(date.getDate() + direction);
            currentDate = date.toISOString().split('T')[0];

            // Initialize temp data for new date
            initializeTempData();
            render();
        }

        // Toggle task
        function toggleTask(taskId) {
            tempData.tasks[taskId] = !tempData.tasks[taskId];
            render();
        }

        // Update recreation counter
        function updateRecreation(taskId, delta) {
            const current = tempData.recreation[taskId] || 0;
            tempData.recreation[taskId] = Math.max(0, Math.min(3, current + delta));
            render();
        }

        // Update penalty counter
        function updatePenalty(penaltyId, delta) {
            const current = tempData.penalties[penaltyId] || 0;
            tempData.penalties[penaltyId] = Math.max(0, current + delta);
            render();
        }

        // Calculate total
        function calculateTotal() {
            let total = 0;

            Object.keys(data).forEach(date => {
                const day = data[date];

                // Tasks
                TASKS.forEach(task => {
                    if (day.tasks && day.tasks[task.id]) {
                        total += task.coins;
                    }
                });

                // Recreation
                RECREATION.forEach(task => {
                    if (day.recreation && day.recreation[task.id]) {
                        total += day.recreation[task.id] * task.coins;
                    }
                });

                // Penalties
                PENALTIES.forEach(penalty => {
                    if (day.penalties && day.penalties[penalty.id]) {
                        total += day.penalties[penalty.id] * penalty.coins;
                    }
                });
            });

            // Check bonuses
            if (checkNoCursing()) total += 25;
            if (checkRecreationStreak()) total += 30;

            return Math.max(0, total);
        }

        // Check no cursing bonus and get progress
        function getNoCursingProgress() {
            const lastWeek = getLastWeekDates();
            let daysWithoutCursing = 0;

            for (let i = 0; i < lastWeek.length; i++) {
                const day = data[lastWeek[i]];
                if (!day || !day.penalties || (!day.penalties.mild_curse && !day.penalties.strong_curse)) {
                    daysWithoutCursing++;
                } else {
                    break; // Stop counting at first curse day
                }
            }

            return {
                current: daysWithoutCursing,
                target: 7,
                achieved: daysWithoutCursing >= 7
            };
        }

        // Check no cursing bonus (legacy function)
        function checkNoCursing() {
            return getNoCursingProgress().achieved;
        }

        // Get recreation streak progress
        function getRecreationProgress() {
            const lastWeek = getLastWeekDates();
            let count = 0;
            lastWeek.forEach(date => {
                const day = data[date];
                if (day && day.recreation) {
                    Object.values(day.recreation).forEach(val => count += val);
                }
            });

            return {
                current: count,
                target: 3,
                achieved: count >= 3
            };
        }

        // Check recreation streak (legacy function)
        function checkRecreationStreak() {
            return getRecreationProgress().achieved;
        }

        // Get last 7 days
        function getLastWeekDates() {
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
            }
            return dates;
        }

        // Toggle history
        function toggleHistory() {
            const history = document.getElementById('history');
            history.classList.toggle('show');
            renderHistory();
        }

        // Render history
        function renderHistory() {
            const history = document.getElementById('history');
            const dates = Object.keys(data).sort((a, b) => new Date(b) - new Date(a));

            history.innerHTML = dates.map(date => {
                let dayTotal = 0;
                const day = data[date];

                TASKS.forEach(task => {
                    if (day.tasks && day.tasks[task.id]) dayTotal += task.coins;
                });

                RECREATION.forEach(task => {
                    if (day.recreation && day.recreation[task.id]) {
                        dayTotal += day.recreation[task.id] * task.coins;
                    }
                });

                PENALTIES.forEach(penalty => {
                    if (day.penalties && day.penalties[penalty.id]) {
                        dayTotal += day.penalties[penalty.id] * penalty.coins;
                    }
                });

                const dateObj = new Date(date);
                const dateStr = dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });

                return `<div class="history-day" onclick="selectDate('${date}')">
                    <span>${dateStr}</span>
                    <span style="color: #ffD700">${dayTotal} coins</span>
                </div>`;
            }).join('');
        }

        // Select date from history
        function selectDate(date) {
            currentDate = date;
            toggleHistory();
            render();
        }

        // Main render function
        function render() {
            // Update total
            document.getElementById('totalCoins').textContent = calculateTotal();

            // Update date display
            const today = new Date().toISOString().split('T')[0];
            const dateObj = new Date(currentDate);
            const dateStr = currentDate === today ? 'Today' :
                dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            document.getElementById('currentDate').textContent = dateStr;

            // Disable next button if current date
            document.getElementById('nextBtn').disabled = currentDate >= today;

            // Render tasks
            const tasksHtml = TASKS.map(task => {
                const completed = tempData.tasks[task.id];
                return `<div class="task ${completed ? 'completed' : ''}" onclick="toggleTask('${task.id}')">
                    <span class="task-name">${task.name}</span>
                    <span class="task-value">+${task.coins}</span>
                </div>`;
            }).join('');
            document.getElementById('tasks').innerHTML = tasksHtml;

            // Render recreation
            const recHtml = RECREATION.map(task => {
                const count = tempData.recreation[task.id] || 0;
                return `<div class="counter-task">
                    <span class="task-name">${task.name}</span>
                    <div class="counter-controls">
                        <button class="counter-btn" onclick="updateRecreation('${task.id}', -1)" ${count === 0 ? 'disabled' : ''}>-</button>
                        <span class="counter-value">${count}</span>
                        <button class="counter-btn" onclick="updateRecreation('${task.id}', 1)" ${count >= 3 ? 'disabled' : ''}>+</button>
                        <span class="task-value">+${task.coins}</span>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('recreation').innerHTML = recHtml;

            // Render penalties with counter controls
            const penHtml = PENALTIES.map(penalty => {
                const count = tempData.penalties[penalty.id] || 0;
                return `<div class="counter-task">
                    <span class="task-name">${penalty.name}</span>
                    <div class="counter-controls">
                        <button class="counter-btn" onclick="updatePenalty('${penalty.id}', -1)" ${count === 0 ? 'disabled' : ''}>-</button>
                        <span class="counter-value">${count}</span>
                        <button class="counter-btn" onclick="updatePenalty('${penalty.id}', 1)">+</button>
                        <span class="task-value" style="color: #ff6b6b">${penalty.coins}</span>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('penalties').innerHTML = penHtml;

            // Render bonuses with progress indicators
            const noCursingProgress = getNoCursingProgress();
            const recreationProgress = getRecreationProgress();

            const bonusHtml = `
                <div class="bonus ${noCursingProgress.achieved ? 'active' : ''}">
                    <div class="bonus-header">
                        <span>No Cursing (7 days)</span>
                        <span class="task-value">+25</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(noCursingProgress.current / noCursingProgress.target) * 100}%"></div>
                    </div>
                    <div class="progress-text">${noCursingProgress.current} / ${noCursingProgress.target} days</div>
                </div>
                <div class="bonus ${recreationProgress.achieved ? 'active' : ''}">
                    <div class="bonus-header">
                        <span>Recreation Streak (3+ in 7 days)</span>
                        <span class="task-value">+30</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${Math.min(100, (recreationProgress.current / recreationProgress.target) * 100)}%"></div>
                    </div>
                    <div class="progress-text">${recreationProgress.current} / ${recreationProgress.target} activities</div>
                </div>`;
            document.getElementById('bonuses').innerHTML = bonusHtml;

            // Update submit button state
            const submitBtn = document.getElementById('submitBtn');
            const hasChanges = checkForChanges();
            if (hasChanges) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'SUBMIT DAILY PROGRESS';
            } else {
                const savedData = data[currentDate];
                if (savedData && (Object.keys(savedData.tasks).length > 0 ||
                    Object.keys(savedData.recreation).length > 0 ||
                    Object.keys(savedData.penalties).length > 0)) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = '‚úÖ ALREADY SAVED';
                } else {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'SUBMIT DAILY PROGRESS';
                }
            }
        }

        // Check if there are unsaved changes
        function checkForChanges() {
            const savedData = data[currentDate] || { tasks: {}, recreation: {}, penalties: {} };
            return JSON.stringify(savedData) !== JSON.stringify(tempData);
        }

        // Initialize
        loadData();
    </script>
</body>
</html>