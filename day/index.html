<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>James' GOATED Homepage</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root {
      --primary: #004C54;
      --secondary: #A5ACAF;
      --accent: #00C9B7;
      --background: #0A1612;
      --cardBg: #1A2822;
      --text: #E8F5F3;
      --sithI: 0.9; /* Sith-only per-widget intensity (updated via JS when Sith is active) */
    }

    * { box-sizing: border-box; }
    html, body { width: 100%; max-width: 100%; }

    /* Blaster canvases: one behind, one above */
    .blaster-bg, .blaster-fg {
      position: fixed;
      inset: 0;
      overflow: hidden;
      pointer-events: none; /* never block clicks */
    }
    .blaster-bg { z-index: 0; background: radial-gradient(100% 140% at 50% 0%, #0a0a12 0%, #05060a 60%, #020307 100%); }
    .blaster-fg { z-index: 999; } /* rare ‚Äútop z-axis‚Äù streaks */

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--background);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      position: relative;
      overflow-x: hidden;
    }

    /* App wrapper sits above bg effects, below optional fg effects */
    .app {
      position: relative;
      z-index: 1;
      padding: max(12px, env(safe-area-inset-top)) clamp(12px, 3vw, 24px) clamp(12px, 3vw, 24px);
    }

    /* Controls (now inside header, flow naturally) */
    .controls {
      position: static;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
      margin-bottom: 8px;
      z-index: 1000;
    }
    .controls select, .controls button {
      border-radius: 12px;
      border: 2px solid var(--accent);
      padding: 10px 12px;
      font-weight: 600;
      font-family: inherit;
      min-height: 44px;
    }
    .controls select {
      background: var(--cardBg);
      color: var(--text);
    }
    .controls button {
      background: var(--secondary);
      color: #000;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
      transition: all .2s ease;
    }
    .controls button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    }

    /* Header */
    .header {
      background: var(--primary);
      padding: clamp(20px, 4vw, 30px);
      border-radius: 16px;
      margin-bottom: clamp(15px, 3vw, 25px);
      margin-top: clamp(8px, 2vh, 20px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      border: 2px solid rgba(0,0,0,0.1);
      text-align: center;
    }
    .header h1 {
      margin: 0;
      font-size: clamp(28px, 6vw, 48px);
      font-weight: 800;
      letter-spacing: -0.5px;
      line-height: 1.2;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
      color: var(--text);
    }

    /* Grid: full-bleed, dense packing, end-to-end */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(100%, 280px), 1fr));
      gap: clamp(12px, 2.5vw, 22px);
      width: 100%;
      margin: 0;
      padding-bottom: env(safe-area-inset-bottom, 0);
      grid-auto-flow: dense;
      position: relative;
      z-index: 5;
    }

    .widget {
      background: var(--cardBg);
      border: 2px solid color-mix(in srgb, var(--accent) 30%, transparent);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      overflow: hidden;
      transition: all 0.3s ease;
      position: relative;

      /* stretch to fill grid cell vertically */
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .widget:hover {
      box-shadow: 0 8px 32px color-mix(in srgb, var(--accent) 40%, transparent);
      transform: translateY(-2px);
      border-color: color-mix(in srgb, var(--accent) 50%, transparent);
    }

    .widget-header {
      padding: clamp(14px, 3vw, 18px);
      font-weight: 700;
      font-size: clamp(14px, 3vw, 16px);
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
      letter-spacing: 0.5px;
      background: var(--primary);
      border-bottom: 2px solid color-mix(in srgb, var(--accent) 40%, transparent);
    }
    .widget-body { 
      color: var(--text);
      flex: 1 1 auto;
      display: block;
    }

    /* Sith subtle irregular glow (layered reds/orange/white; no moving elements) */
    @keyframes sithShimmerTiny {
      0%   { filter: saturate(1) contrast(1); }
      50%  { filter: saturate(1.03) contrast(1.02); }
      100% { filter: saturate(1) contrast(1); }
    }
    .sith-glow {
      border-color: rgba(255, 0, 0, 0.35);
      box-shadow:
        0 0 calc(6px  * var(--sithI, 0.9)) 0 rgba(255,255,255,0.10),
        0 0 calc(14px * var(--sithI, 0.9)) 2px #ff0000,
        0 0 calc(28px * var(--sithI, 0.9)) 6px #ff4500,
        0 0 calc(52px * var(--sithI, 0.9)) 12px rgba(139,0,0,0.45),
        inset 0 0 calc(10px * var(--sithI, 0.9)) 0 rgba(255,0,0,0.10),
        inset 0 0 calc(24px * var(--sithI, 0.9)) 8px rgba(139,0,0,0.20);
      animation: sithShimmerTiny 420ms steps(2, end) infinite;
    }
    .sith-glow .btn-screen-info {
      box-shadow:
        0 0 calc(6px * var(--sithI, 0.9)) 0 rgba(255,255,255,0.10),
        0 0 calc(14px * var(--sithI, 0.9)) 2px #ff0000,
        0 0 calc(24px * var(--sithI, 0.9)) 8px rgba(139,0,0,0.35);
    }

    /* ----- Upgraded Blaster Beam + Sparks ----- */

    /* Blaster beam (core + bloom + motion blur) */
    .bolt {
      position: absolute;
      top: 0; left: 0;
      width: 120px;             /* JS will override per-instance */
      height: 2px;              /* JS will override per-instance */
      border-radius: 999px;
      will-change: transform, opacity, filter;
      opacity: 0.95;
      box-shadow:
        0 0 6px currentColor,
        0 0 12px currentColor,
        0 0 22px currentColor,
        0 0 44px currentColor;
      filter: saturate(1.5);
      background: linear-gradient(90deg, rgba(255,255,255,0.95) 0%, currentColor 35%, rgba(0,0,0,0) 100%);
      contain: layout paint;
    }
    .bolt::before {
      content: "";
      position: absolute;
      inset: -1px -6px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,255,255,0.85) 10%, currentColor 50%, rgba(0,0,0,0) 100%);
      filter: blur(1px);
      opacity: 0.9;
    }
    .bolt::after {
      content: "";
      position: absolute;
      left: -6px;
      top: 50%;
      transform: translateY(-50%);
      width: 10px; height: 10px;
      border-radius: 50%;
      background: #fff;
      filter: blur(1.2px);
      opacity: 0.9;
    }

    /* Tiny spark pops in the background */
    .spark {
      position: absolute;
      width: 3px; height: 3px;
      border-radius: 50%;
      pointer-events: none;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.95) 0%, currentColor 35%, rgba(0,0,0,0) 70%);
      box-shadow:
        0 0 6px currentColor,
        0 0 12px currentColor;
      opacity: 0;
      animation: sparkPop 600ms ease-out forwards;
    }
    @keyframes sparkPop {
      0%   { transform: translate3d(0,0,0) scale(0.6); opacity: 0; }
      20%  { opacity: 1; }
      60%  { transform: translate3d(var(--sx, 6px), var(--sy, -6px), 0) scale(1.4); opacity: 0.9; }
      100% { transform: translate3d(calc(var(--sx, 6px)*1.2), calc(var(--sy, -6px)*1.2), 0) scale(0.9); opacity: 0; }
    }

    @media (prefers-reduced-motion: reduce) {
      .sith-glow { animation: none !important; }
      /* JS also disables blasters in reduced motion */
    }
    @media (max-width: 767px) {
      .widget-header span { font-size: clamp(13px, 3.5vw, 16px); }
    }
    @media (max-width: 480px) {
      input[type="checkbox"] { min-width: 24px; min-height: 24px; }
    }
    @media (max-width: 380px) {
      .controls select, .controls button { width: 100%; }
      .header h1 { font-size: clamp(22px, 7vw, 40px); }
      .item { gap: 10px; }
    }

    /* Utility */
    .btn-screen-info {
      background: var(--secondary);
      padding: clamp(14px, 3vw, 16px);
      border-radius: 10px;
      margin-top: 15px;
      text-align: center;
      font-weight: 700;
      font-size: clamp(17px, 4vw, 22px);
      color: #000;
      box-shadow: 0 4px 16px color-mix(in srgb, var(--secondary) 40%, transparent);
      border: 2px solid var(--accent);
    }
    .item {
      padding: clamp(12px, 3vw, 14px);
      margin-bottom: 10px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: clamp(15px, 3.5vw, 17px);
      min-height: 48px;
      touch-action: manipulation;
      transition: all .2s ease;
      font-weight: 500;
      border: 2px solid color-mix(in srgb, var(--secondary) 40%, transparent);
      background: color-mix(in srgb, var(--background) 80%, transparent);
    }
    .item.done {
      border-color: var(--accent);
      background: color-mix(in srgb, var(--accent) 30%, transparent);
      text-decoration: line-through;
    }
  </style>
</head>
<body>
  <!-- Blaster layers -->
  <div class="blaster-bg" id="blaster-bg" aria-hidden="true"></div>
  <div class="blaster-fg" id="blaster-fg" aria-hidden="true"></div>

  <main class="app">
    <!-- Header (controls moved inside) -->
    <div id="header" class="header">
      <div class="controls">
        <select id="teamSelect" aria-label="Choose theme"></select>
        <button id="teamToggle">Toggle Theme</button>
      </div>
      <h1>üåü JAMES' GOATED HOMEPAGE üåü</h1>
    </div>

    <!-- Grid -->
    <div class="grid">
      <!-- Today -->
      <div class="widget sith-optional" id="w-today">
        <div class="widget-header"><span>üìÖ TODAY IS...</span></div>
        <div class="widget-body" style="padding: clamp(20px, 4vw, 28px); text-align:center; font-weight:600;">
          <div id="dayName" style="margin-bottom:12px; color: var(--accent); font-size: clamp(20px, 5vw, 28px);">‚Äî</div>
          <div id="dateStr" style="font-size: clamp(16px, 3.5vw, 20px); color: var(--secondary); font-weight:500;">‚Äî</div>
        </div>
      </div>

      <!-- Time -->
      <div class="widget sith-optional" id="w-time">
        <div class="widget-header"><span>‚è∞ CURRENT TIME</span></div>
        <div class="widget-body" style="padding: clamp(20px, 4vw, 28px); text-align:center; font-weight:700; font-family: monospace; font-size: clamp(36px, 8vw, 54px); color: var(--accent);" id="timeStr">‚Äî</div>
      </div>

      <!-- Quote -->
      <div class="widget sith-optional" id="w-quote" style="grid-column: 1 / -1;">
        <div class="widget-header"><span>‚≠ê QUOTE OF THE DAY</span></div>
        <div class="widget-body" style="padding: clamp(20px, 4vw, 30px); line-height:1.6;">
          <div id="quoteText" style="font-size: clamp(16px, 3.5vw, 22px); margin-bottom: 15px; font-weight: 500; font-style: italic;">"Loading‚Ä¶"</div>
          <div id="quoteAuthor" style="font-size: clamp(14px, 3vw, 18px); text-align: right; margin-bottom: 0; font-weight: 600; color: var(--accent);">‚Äî</div>
          <div id="quoteExplWrap" style="display:none; margin-top: 20px;">
            <div style="font-size: clamp(14px, 3vw, 16px); background: color-mix(in srgb, var(--accent) 20%, transparent); padding: 16px; border-radius: 10px; color: var(--text); line-height:1.6; font-weight: 500; border: 2px solid color-mix(in srgb, var(--accent) 40%, transparent);">
              <strong style="font-size: clamp(15px, 3.2vw, 17px); color: var(--accent)">üí° What it means:</strong>
              <span id="quoteExplanation"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Morning checklist -->
      <div class="widget sith-optional" id="w-morning">
        <div class="widget-header"><span>üéí DON'T FORGET!</span></div>
        <div class="widget-body" style="padding: clamp(15px, 3vw, 20px);">
          <div id="morningList"></div>
        </div>
      </div>

      <!-- Screen time rules -->
      <div class="widget sith-optional" id="w-screen">
        <div class="widget-header"><span>üì∫ EARN SCREEN TIME!</span></div>
        <div class="widget-body" style="padding: clamp(15px, 3vw, 20px);">
          <div id="screenList"></div>
          <div id="screenAllowance" class="btn-screen-info" style="color:#000;">‚Äî</div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // ======= Data =======
    const teamColors = {
      'Philadelphia Eagles': { primary:'#004C54', secondary:'#A5ACAF', accent:'#00C9B7', background:'#0A1612', cardBg:'#1A2822', text:'#E8F5F3' },
      'Green Bay Packers':  { primary:'#203731', secondary:'#FFB612', accent:'#FFD24D', background:'#0D1410', cardBg:'#1C2A1F', text:'#FFF8E7' },
      'Baltimore Ravens':   { primary:'#241773', secondary:'#9E7C0C', accent:'#D3BC8D', background:'#0E0A1A', cardBg:'#1C1528', text:'#F0EBFF' },
      'Pittsburgh Steelers':{ primary:'#000000', secondary:'#FFB612', accent:'#C60C30', background:'#0A0A0A', cardBg:'#1A1A1A', text:'#FFF8E7' },
      'Philadelphia Union': { primary:'#041E42', secondary:'#B1976B', accent:'#F0B726', background:'#020D1A', cardBg:'#0A1929', text:'#F5F3E8' },
      'Sith':               { primary:'#000000', secondary:'#CC0000', accent:'#FF0000', background:'#0D0D0D', cardBg:'#1A1A1A', text:'#E8E8E8' },
      'Boba Fett':          { primary:'#4B6B50', secondary:'#7A2C27', accent:'#D9A628', background:'#1C1C1C', cardBg:'#2A2A2A', text:'#FFFFFF' }
    };
    const teamNames = Object.keys(teamColors);

    const STORAGE_KEYS = {
      team: 'aolkids.currentTeam',
      morning: 'aolkids.morningChecklist',
      screen: 'aolkids.screenTimeChecklist',
      quote: 'aolkids.lastQuote'
    };

    const defaultMorning = [
      { id:1, text:'üõèÔ∏è Make Bed', done:false },
      { id:2, text:'ü™• Brush Teeth', done:false },
      { id:3, text:'üëï Get Dressed', done:false },
      { id:4, text:'üíß Fill Up Water', done:false },
      { id:5, text:'üéí Pack School Bag (Homework, Lunch, Snack)', done:false },
      { id:6, text:'üç≥ Eat Breakfast', done:false },
      { id:7, text:'üßπ Clear Table', done:false }
    ];
    const defaultScreen = [
      { id:1, text:'üìö Finish all homework', done:false },
      { id:2, text:'üßπ Clean up room', done:false },
      { id:3, text:'üèÉ 30 minutes of physical activity or exercise', done:false },
      { id:4, text:'üß∫ Help with one chore', done:false }
    ];

    // ======= State =======
    let currentTeam = localStorage.getItem(STORAGE_KEYS.team);
    if (!currentTeam || !teamColors[currentTeam]) currentTeam = 'Philadelphia Eagles';

    let morningChecklist = JSON.parse(localStorage.getItem(STORAGE_KEYS.morning) || 'null') || defaultMorning;
    let screenChecklist  = JSON.parse(localStorage.getItem(STORAGE_KEYS.screen)  || 'null') || defaultScreen;

    // ======= DOM helpers =======
    const $ = s => document.querySelector(s);
    const setThemeVars = (team) => {
      const c = teamColors[team];
      const root = document.documentElement;
      root.style.setProperty('--primary', c.primary);
      root.style.setProperty('--secondary', c.secondary);
      root.style.setProperty('--accent', c.accent);
      root.style.setProperty('--background', c.background);
      root.style.setProperty('--cardBg', c.cardBg);
      root.style.setProperty('--text', c.text);
      $('#teamToggle').style.color = (team === 'Boba Fett') ? c.text : '#000';
    };

    // ======= Sith irregular glow driver (per-widget) =======
    const sithState = {
      active: false, rafId: null, widgets: [], map: new WeakMap()
    };
    function initSithWidget(el) {
      if (!sithState.map.has(el)) {
        const seed = 0.80 + Math.random() * 0.15;
        sithState.map.set(el, { ema: seed, burst: 0, last: performance.now() });
        el.style.setProperty('--sithI', seed.toFixed(3));
        el.classList.add('sith-glow');
      }
    }
    function clearSithWidget(el) {
      el.classList.remove('sith-glow');
      el.style.removeProperty('--sithI');
      sithState.map.delete(el);
    }
    const SITH_CONFIG = {
      baseIntensity: 0.88, jitterAmount: 0.14, ema: 0.18,
      burstChance: 0.035, burstBoost: 0.38, burstHalfLife: 120,
      minInterval: 14, maxIntensity: 1.25, minIntensity: 0.70
    };
    const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
    function randStep(amount) {
      const r = Math.random();
      const mag = r < 0.85 ? (Math.random() * 0.5) : (0.5 + Math.random() * 1.0);
      const sign = Math.random() < 0.55 ? -1 : 1;
      return sign * mag * amount;
    }
    function sithTick(ts) {
      if (!sithState.active) return;
      sithState.rafId = requestAnimationFrame(sithTick);
      sithState.widgets.forEach(el => {
        const st = sithState.map.get(el); if (!st) return;
        const dt = ts - st.last || 16; if (dt < SITH_CONFIG.minInterval) return;
        st.last = ts;
        if (Math.random() < SITH_CONFIG.burstChance) {
          st.burst += SITH_CONFIG.burstBoost * (0.6 + Math.random() * 0.6);
        }
        const half = Math.max(40, SITH_CONFIG.burstHalfLife);
        st.burst *= Math.pow(0.5, dt / half);
        const noise = SITH_CONFIG.baseIntensity + randStep(SITH_CONFIG.jitterAmount);
        st.ema = (1 - SITH_CONFIG.ema) * noise + SITH_CONFIG.ema * st.ema;
        let intensity = st.ema + st.burst;
        intensity = clamp(intensity, SITH_CONFIG.minIntensity, SITH_CONFIG.maxIntensity);
        el.style.setProperty('--sithI', intensity.toFixed(3));
      });
    }
    function applySith(enable) {
      const els = document.querySelectorAll('.sith-optional');
      if (enable) {
        els.forEach(initSithWidget);
        sithState.widgets = Array.from(els);
        if (!sithState.active) {
          sithState.active = true;
          sithState.rafId = requestAnimationFrame(sithTick);
        }
      } else {
        sithState.active = false;
        if (sithState.rafId) cancelAnimationFrame(sithState.rafId);
        sithState.rafId = null;
        sithState.widgets.forEach(clearSithWidget);
        sithState.widgets = [];
      }
    }

    // ======= Boba Fett: Background & Foreground blaster manager (RGB + sparks) =======
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const blaster = {
      active: false,
      bg: $('#blaster-bg'),
      fg: $('#blaster-fg'),
      timers: { bg: null, fg: null, spark: null },
      pool: [],
      config: {
        // Background cadence
        spawnEveryMs: [60, 180],
        maxBolts: 80,
        speedPxPerSec: [900, 1800],      // punchier
        thicknessPx: [1.5, 3.5],
        lengthPx: [90, 200],             // longer beams
        angleJitterDeg: [-6, 6],
        fadeInMs: 60,
        fadeOutMs: 120,
        blurPx: [0.4, 1.1],
        leftBias: 0.5,

        // Foreground ‚Äútop z-axis‚Äù bolt cadence (every 2‚Äì5 seconds)
        fgEveryMs: [2000, 5000],
        fgSpeedPxPerSec: [900, 1800],
        fgLengthPx: [120, 240],
        fgThicknessPx: [2, 4],
        fgBlurPx: [0.6, 1.4],

        // Sparks
        sparkEveryMs: [120, 380],
        sparkMax: 120,
        sparkSizePx: [2, 5],
      },
      palettes: {
        // Strict RGB only
        reds:   ['#ff2a2a', '#ff3b30', '#ff4d2a'],
        greens: ['#18ff3b', '#2aff2a', '#00ff66'],
        blues:  ['#4fc3f7', '#00bcd4', '#7dd3fc']
      }
    };
    function rand(min, max) { return min + Math.random() * (max - min); }
    function pick(arr) { return arr[(Math.random() * arr.length) | 0]; }
    function getBoltFromPool() { return blaster.pool.pop() || document.createElement('div'); }
    function recycleBolt(node) { node.remove(); blaster.pool.push(node); }

    function setBeamGradientByDirection(el, dirLeftToRight) {
      el.style.background = dirLeftToRight
        ? 'linear-gradient(90deg, rgba(255,255,255,0.95) 0%, currentColor 35%, rgba(0,0,0,0) 100%)'
        : 'linear-gradient(270deg, rgba(255,255,255,0.95) 0%, currentColor 35%, rgba(0,0,0,0) 100%)';
    }

    function spawnBolt(container, opts) {
      if (!blaster.active) return;
      const vw = container.clientWidth || window.innerWidth;
      const vh = container.clientHeight || window.innerHeight;

      const dirLeftToRight = Math.random() < (opts.leftBias ?? 0.5);
      const y = Math.random() * vh;
      const length = rand(...opts.lengthPx);
      const thickness = rand(...opts.thicknessPx);
      const angle = rand(...opts.angleJitterDeg);
      const blur = rand(...opts.blurPx) * 1.25; // stronger smear
      const speed = rand(...opts.speedPxPerSec);
      const color = pick(opts.colors);

      const bolt = getBoltFromPool();
      bolt.className = 'bolt';
      bolt.style.color = color;
      bolt.style.height = thickness + 'px';
      bolt.style.width = length + 'px';
      bolt.style.filter = `saturate(1.5) blur(${blur}px)`;
      setBeamGradientByDirection(bolt, dirLeftToRight);

      const startX = dirLeftToRight ? -length - 20 : vw + 20;
      const endX   = dirLeftToRight ? vw + 20 : -length - 20;

      bolt.style.transform = `translate3d(${startX}px, ${y}px, 0) rotate(${angle}deg)`;
      bolt.style.opacity = '0';
      container.appendChild(bolt);

      const distance = Math.abs(endX - startX);
      const totalMs = (distance / speed) * 1000;
      const start = performance.now();

      function step(now) {
        if (!blaster.active) { recycleBolt(bolt); return; }
        const t = now - start;
        const p = t / totalMs;
        if (p >= 1) { recycleBolt(bolt); return; }

        const x = startX + (endX - startX) * p;
        bolt.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(${angle}deg)`;

        let alpha = 1;
        if (t < opts.fadeInMs) alpha = t / opts.fadeInMs;
        else if (totalMs - t < opts.fadeOutMs) alpha = (totalMs - t) / opts.fadeOutMs;
        bolt.style.opacity = alpha.toFixed(3);

        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function spawnSpark() {
      if (!blaster.active) return;
      const vw = blaster.bg.clientWidth || window.innerWidth;
      const vh = blaster.bg.clientHeight || window.innerHeight;

      const node = document.createElement('div');
      node.className = 'spark';

      // random position
      const x = Math.random() * vw;
      const y = Math.random() * vh;

      // random small drift for the keyframe var()
      const dx = (Math.random() * 14 - 7).toFixed(1) + 'px';
      const dy = (Math.random() * 14 - 7).toFixed(1) + 'px';
      node.style.setProperty('--sx', dx);
      node.style.setProperty('--sy', dy);

      // random color among RGB
      const pool = [
        ...blaster.palettes.blues,
        ...blaster.palettes.greens,
        ...blaster.palettes.reds
      ];
      node.style.color = pick(pool);

      // random size
      const s = rand(...blaster.config.sparkSizePx);
      node.style.width = s + 'px';
      node.style.height = s + 'px';

      node.style.transform = `translate3d(${x}px, ${y}px, 0)`;

      blaster.bg.appendChild(node);

      // cleanup after animation completes
      setTimeout(() => node.remove(), 650);
    }

    function scheduleBgSpawn() {
      if (!blaster.active) return;
      const colors = [
        ...blaster.palettes.blues,
        ...blaster.palettes.greens,
        ...blaster.palettes.reds
      ];
      const opts = {
        colors,
        speedPxPerSec: blaster.config.speedPxPerSec,
        thicknessPx: blaster.config.thicknessPx,
        lengthPx: blaster.config.lengthPx,
        angleJitterDeg: blaster.config.angleJitterDeg,
        fadeInMs: blaster.config.fadeInMs,
        fadeOutMs: blaster.config.fadeOutMs,
        blurPx: blaster.config.blurPx,
        leftBias: blaster.config.leftBias
      };
      // safety cap
      if (blaster.bg.childElementCount < blaster.config.maxBolts) {
        spawnBolt(blaster.bg, opts);
      }
      const delay = rand(...blaster.config.spawnEveryMs);
      blaster.timers.bg = setTimeout(scheduleBgSpawn, delay);
    }

    function scheduleFgBurst() {
      if (!blaster.active) return;
      const colors = [
        ...blaster.palettes.blues,
        ...blaster.palettes.greens,
        ...blaster.palettes.reds
      ];
      const opts = {
        colors,
        speedPxPerSec: blaster.config.fgSpeedPxPerSec,
        thicknessPx: blaster.config.fgThicknessPx,
        lengthPx: blaster.config.fgLengthPx,
        angleJitterDeg: blaster.config.angleJitterDeg,
        fadeInMs: blaster.config.fadeInMs,
        fadeOutMs: blaster.config.fadeOutMs,
        blurPx: blaster.config.fgBlurPx,
        leftBias: Math.random() < 0.5 ? 0.3 : 0.7 // slight asymmetry
      };
      spawnBolt(blaster.fg, opts);
      const delay = rand(...blaster.config.fgEveryMs); // every 2‚Äì5s
      blaster.timers.fg = setTimeout(scheduleFgBurst, delay);
    }

    function scheduleSpark() {
      if (!blaster.active) return;
      // soft cap
      if (blaster.bg.querySelectorAll('.spark').length < blaster.config.sparkMax) {
        spawnSpark();
        if (Math.random() < 0.15) spawnSpark(); // occasional multi-pop
      }
      const delay = rand(...blaster.config.sparkEveryMs);
      blaster.timers.spark = setTimeout(scheduleSpark, delay);
    }

    function startBlasters() {
      if (blaster.active || prefersReducedMotion) return;
      blaster.active = true;
      scheduleBgSpawn();
      scheduleFgBurst(); // foreground bolt every 2‚Äì5 seconds
      scheduleSpark();

      // front-load a few background bolts so it feels alive instantly
      const pool = [
        ...blaster.palettes.blues,
        ...blaster.palettes.greens,
        ...blaster.palettes.reds
      ];
      for (let i = 0; i < 10; i++) spawnBolt(blaster.bg, {
        colors: pool,
        speedPxPerSec: blaster.config.speedPxPerSec,
        thicknessPx: blaster.config.thicknessPx,
        lengthPx: blaster.config.lengthPx,
        angleJitterDeg: blaster.config.angleJitterDeg,
        fadeInMs: blaster.config.fadeInMs,
        fadeOutMs: blaster.config.fadeOutMs,
        blurPx: blaster.config.blurPx,
        leftBias: blaster.config.leftBias
      });
    }

    function stopBlasters() {
      blaster.active = false;
      clearTimeout(blaster.timers.bg); blaster.timers.bg = null;
      clearTimeout(blaster.timers.fg); blaster.timers.fg = null;
      clearTimeout(blaster.timers.spark); blaster.timers.spark = null;
      // Clean up existing nodes
      blaster.bg.querySelectorAll('.bolt').forEach(n => recycleBolt(n));
      blaster.fg.querySelectorAll('.bolt').forEach(n => recycleBolt(n));
      blaster.bg.querySelectorAll('.spark').forEach(n => n.remove());
    }

    // ======= Team select & toggle =======
    const teamSelect = $('#teamSelect');
    teamNames.forEach(n => {
      const opt = document.createElement('option');
      opt.value = n; opt.textContent = n;
      teamSelect.appendChild(opt);
    });
    teamSelect.value = currentTeam;

    const setTeam = (team) => {
      currentTeam = teamColors[team] ? team : 'Philadelphia Eagles';
      localStorage.setItem(STORAGE_KEYS.team, currentTeam);
      setThemeVars(currentTeam);
      // Sith effect
      applySith(currentTeam === 'Sith');
      // Boba blasters
      if (currentTeam === 'Boba Fett') startBlasters();
      else stopBlasters();
    };

    $('#teamToggle').addEventListener('click', () => {
      const idx = teamNames.indexOf(currentTeam);
      const next = teamNames[(idx + 1) % teamNames.length];
      setTeam(next);
      teamSelect.value = next;
    });
    teamSelect.addEventListener('change', (e) => setTeam(e.target.value));

    // ======= Time & Date =======
    const daysOfWeek = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const updateClock = () => {
      const now = new Date();
      $('#timeStr').textContent = now.toLocaleTimeString();
      $('#dateStr').textContent = now.toLocaleDateString();
      $('#dayName').textContent = daysOfWeek[now.getDay()];
      const isWeekend = now.getDay() === 0 || now.getDay() === 6;
      const allowed = isWeekend ? 'two hours' : 'one hour';
      $('#screenAllowance').textContent = isWeekend
        ? 'üéÆ Enjoy two hours of screen time!'
        : `üéÆ Enjoy ${allowed} of screen time!`;
    };

    // ======= Quotes (from ./quotes.json) =======
    const setQuote = (q) => {
      $('#quoteText').textContent = `"${q.text}"`;
      $('#quoteAuthor').textContent = q.author ? `‚Äî ${q.author}` : '‚Äî';
      if (q.explanation) {
        $('#quoteExplanation').textContent = ' ' + q.explanation;
        $('#quoteExplWrap').style.display = '';
      } else {
        $('#quoteExplWrap').style.display = 'none';
      }
      try { localStorage.setItem(STORAGE_KEYS.quote, JSON.stringify(q)); } catch {}
    };

    const loadQuote = async () => {
      try {
        const last = JSON.parse(localStorage.getItem(STORAGE_KEYS.quote) || 'null');
        if (last && last.text) setQuote(last);
      } catch {}
      try {
        const res = await fetch('./quotes.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('quotes.json not found');
        const data = await res.json();
        if (Array.isArray(data) && data.length) {
          const random = data[Math.floor(Math.random() * data.length)];
          setQuote({
            text: random.quote,
            author: random.author || '',
            explanation: random.explanation || ''
          });
          return;
        }
      } catch (e) {
        try {
          const r = await fetch('https://api.quotable.io/random?tags=inspirational|sports');
          const d = await r.json();
          if (d && d.content) {
            setQuote({ text: d.content, author: d.author || '', explanation: '' });
            return;
          }
        } catch {}
        setQuote({
          text: "Hard work beats talent when talent doesn't work hard!",
          author: 'Tim Notke',
          explanation: "Even if you're not the best naturally, working hard can help you succeed!"
        });
      }
    };

    // ======= Checklists =======
    const renderChecklist = (container, list, onToggle) => {
      container.innerHTML = '';
      list.forEach(item => {
        const row = document.createElement('div');
        row.className = 'item' + (item.done ? ' done' : '');
        row.setAttribute('role','button');
        row.setAttribute('tabindex','0');

        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = item.done;
        cb.style.width = '22px';
        cb.style.height = '22px';
        cb.style.accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
        cb.addEventListener('click', e => e.stopPropagation());
        cb.addEventListener('change', () => onToggle(item.id));

        const label = document.createElement('span');
        label.textContent = item.text;
        label.style.flex = '1';

        row.appendChild(cb);
        row.appendChild(label);

        row.addEventListener('click', () => onToggle(item.id));
        row.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') onToggle(item.id);
        });

        container.appendChild(row);
      });
    };

    const toggleMorning = (id) => {
      morningChecklist = morningChecklist.map(it => it.id === id ? { ...it, done: !it.done } : it);
      localStorage.setItem(STORAGE_KEYS.morning, JSON.stringify(morningChecklist));
      renderChecklist($('#morningList'), morningChecklist, toggleMorning);
    };
    const toggleScreen = (id) => {
      screenChecklist = screenChecklist.map(it => it.id === id ? { ...it, done: !it.done } : it);
      localStorage.setItem(STORAGE_KEYS.screen, JSON.stringify(screenChecklist));
      renderChecklist($('#screenList'), screenChecklist, toggleScreen);
    };

    // ======= Init =======
    setThemeVars(currentTeam);
    applySith(currentTeam === 'Sith');
    if (currentTeam === 'Boba Fett') startBlasters();

    updateClock();
    setInterval(updateClock, 1000);
    loadQuote();

    renderChecklist($('#morningList'), morningChecklist, toggleMorning);
    renderChecklist($('#screenList'),  screenChecklist,  toggleScreen);

  </script>
</body>
</html>
